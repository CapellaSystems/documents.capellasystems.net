"use strict";(self.webpackChunkcapella_documentation=self.webpackChunkcapella_documentation||[]).push([[3715],{1045:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Cambria FTC/Installation Guides/Kubernetes/AWS/cambria-cluster-ftc-aws","title":"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes","description":"Document History","source":"@site/docs/Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS/index.md","sourceDirName":"Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS","slug":"/Cambria FTC/Installation Guides/Kubernetes/AWS/","permalink":"/docs/Cambria FTC/Installation Guides/Kubernetes/AWS/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"cambria-cluster-ftc-aws","title":"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes"},"sidebar":"FTCSidebar","next":{"title":"Cambria Cluster / FTC 5.5.0 - Terraform on Akamai Kubernetes","permalink":"/docs/Cambria FTC/Installation Guides/Kubernetes/Akamai/"}}');var i=s(4848),t=s(8453);const l={id:"cambria-cluster-ftc-aws",title:"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes"},c=void 0,a={},d=[{value:"Document History",id:"document-history",level:2},{value:"Limitations and Security Information",id:"limitations-and-security-information",level:3},{value:"\u26a0\ufe0f Important: Before You Begin",id:"\ufe0f-important-before-you-begin",level:2},{value:"\u26a0\ufe0f Critical Information: Read Before Proceeding with Installation",id:"\ufe0f-critical-information-read-before-proceeding-with-installation",level:2},{value:"Document Overview",id:"document-overview",level:2},{value:"Document Structure",id:"document-structure",level:3},{value:"1. Overview",id:"1-overview",level:2},{value:"1.1 Cambria Cluster / FTC Kubernetes Deployment",id:"11-cambria-cluster--ftc-kubernetes-deployment",level:3},{value:"Cambria Cluster",id:"cambria-cluster",level:3},{value:"Cambria FTC",id:"cambria-ftc",level:3},{value:"Deployment Note",id:"deployment-note",level:3},{value:"1.2 Resource Usage",id:"12-resource-usage",level:3},{value:"Reference Documentation:",id:"reference-documentation",level:4},{value:"Resource Overview",id:"resource-overview",level:4},{value:"Security Groups",id:"security-groups",level:4},{value:"1.3 AWS Machine Information and Benchmark",id:"13-aws-machine-information-and-benchmark",level:3},{value:"Benchmark Job Configuration",id:"benchmark-job-configuration",level:4},{value:"a. <code>c6a.4xlarge</code> [AMD EPYC 7R13]",id:"a-c6a4xlarge-amd-epyc-7r13",level:4},{value:"Machine Info",id:"machine-info",level:5},{value:"Benchmark Results",id:"benchmark-results",level:5},{value:"b. <code>c6a.16xlarge</code> [AMD EPYC 7R13]",id:"b-c6a16xlarge-amd-epyc-7r13",level:4},{value:"Machine Info",id:"machine-info-1",level:5},{value:"Benchmark Results",id:"benchmark-results-1",level:5},{value:"Benchmark Summary",id:"benchmark-summary",level:4},{value:"1.4 Cambria Application Access",id:"14-cambria-application-access",level:3},{value:"1.4.1 External Access via TCP Load Balancer",id:"141-external-access-via-tcp-load-balancer",level:4},{value:"1.4.2 HTTP Ingress via Reverse Proxy",id:"142-http-ingress-via-reverse-proxy",level:4},{value:"1.5 Firewall Information",id:"15-firewall-information",level:3},{value:"2. Prerequisites",id:"2-prerequisites",level:3},{value:"2.1 Tools: Kubectl, Helm, Eksctl, and AWS CLI",id:"21-tools-kubectl-helm-eksctl-and-aws-cli",level:4},{value:"2.1.1 Installation",id:"211-installation",level:5},{value:"2.1.2 Verification",id:"212-verification",level:5},{value:"2.2 Create and Configure AWS Permissions",id:"22-create-and-configure-aws-permissions",level:4},{value:"2.2.1 Create Custom Policies",id:"221-create-custom-policies",level:5},{value:"2.2.2 Create and Assign Eksctl AWS Role",id:"222-create-and-assign-eksctl-aws-role",level:5},{value:"3. Create Kubernetes Cluster",id:"3-create-kubernetes-cluster",level:3},{value:"3.1 Create AWS EKS Cluster and Node Group",id:"31-create-aws-eks-cluster-and-node-group",level:4}];function o(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"document-history",children:"Document History"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Date"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.4.0"}),(0,i.jsx)(n.td,{children:"10/03/2024"}),(0,i.jsx)(n.td,{children:"Updated for release 5.4.0.21627 (Linux)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.5.0"}),(0,i.jsx)(n.td,{children:"04/11/2025"}),(0,i.jsx)(n.td,{children:"Updated for release 5.5.0.23529 (Linux)"})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Download the online version of this document for the latest information and latest files. Always download the latest files."})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Do not move forward with the installation process if you do not agree with the End User License Agreement (EULA) for our products.",(0,i.jsx)(n.br,{}),"\n","You can download and read the EULA for Cambria FTC, Cambria Cluster, and Cambria License Manager from the links below:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/1wg7ee7a59kzi8h/EULA_Cambria_License_Manager.pdf?dl=0",children:"Cambria License Manager EULA"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/oemlax63aatjjiw/EULA_Cluster.pdf?dl=0",children:"Cambria Cluster EULA"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/ualv9usxsowh6m2/EULA_FTC.pdf?dl=0",children:"Cambria FTC EULA"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"limitations-and-security-information",children:"Limitations and Security Information"}),"\n",(0,i.jsx)(n.p,{children:"Cambria FTC, Cluster, and License Manager are installed on Linux Docker containers. Limitations and security checks done for this version are included in our general Linux Documents below:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/0rvskhpqtla6dffhbfli5/Linux_Cambria_Cluster_and_FTC_5_5_0_Guide.pdf?rlkey=ngryjzox121ow5fgbc4y8n2yd",children:"Linux Cambria Cluster and FTC 5.5.0 Guide"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," These documents are for informational use only. The setup for Kubernetes starts in section 3. Create Kubernetes Cluster.",(0,i.jsx)(n.br,{}),"\n","This document references Kubernetes version 1.32.1 only."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-important-before-you-begin",children:"\u26a0\ufe0f Important: Before You Begin"}),"\n",(0,i.jsx)(n.p,{children:"PDF documents have a copy/paste issue. For best results, download this document and any referenced PDF documents in this guide and open them in a PDF viewer such as Adobe Acrobat."}),"\n",(0,i.jsx)(n.p,{children:"For commands that are in more than one line, copy each line one by one and check that the copied command matches the one in the document."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-critical-information-read-before-proceeding-with-installation",children:"\u26a0\ufe0f Critical Information: Read Before Proceeding with Installation"}),"\n",(0,i.jsx)(n.p,{children:"Before starting the installation, carefully review the following considerations. Skipping this section may result in errors, failed deployments, or misconfigurations."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"A New Kubernetes Cluster Will Be Deployed"}),(0,i.jsx)(n.br,{}),"\n","\u25cf The installation process creates a brand-new Kubernetes cluster to keep the Cambria ecosystem isolated from other applications."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default Installation is Non-Secure"}),(0,i.jsx)(n.br,{}),"\n","\u25cf The guide covers installation with default settings in an open environment (not secure).",(0,i.jsx)(n.br,{}),"\n","\u25cf If you require a secure or customized setup, you will need AWS expertise, which is not covered in this guide.",(0,i.jsx)(n.br,{}),"\n","\u25cf Firewall information is provided in section 1.5. Firewall Information"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Understand Your Transcoding Requirements"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Know your expected transcoding volume, input/output specs, and whether a GPU is needed.",(0,i.jsx)(n.br,{}),"\n","\u25cf Refer to section 1.3. AWS EC2 Instance Information and Benchmark for guidelines on machine requirements."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Administrative Rights Required"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Many of the steps in this guide require administrative rights to AWS for adding permissions and performing other administrative functions of that sort."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check AWS Account Quota"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Ensure the AWS account has sufficient quota to deploy Kubernetes resources.",(0,i.jsx)(n.br,{}),"\n","\u25cf See section 1.2. Resource Usage for estimated resource requirements."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"A Separate Linux Machine is Required"}),(0,i.jsx)(n.br,{}),"\n","\u25cf A dedicated Linux machine (preferably Ubuntu) is needed to deploy Kubernetes.",(0,i.jsx)(n.br,{}),"\n","\u25cf Keeping Kubernetes tools and configuration files on a dedicated system is strongly recommended."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify Region-Specific Resource Availability"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Not all AWS regions support the same resources (e.g., GPU availability varies by region).",(0,i.jsx)(n.br,{}),"\n","\u25cf Consult AWS documentation to confirm available resources in your desired region."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"document-overview",children:"Document Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The purpose of this document is to provide a walkthrough of the installation and initial testing process of the ",(0,i.jsx)(n.strong,{children:"Cambria Cluster"})," and ",(0,i.jsx)(n.strong,{children:"Cambria FTC"})," applications in a Kubernetes environment."]}),"\n",(0,i.jsx)(n.h3,{id:"document-structure",children:"Document Structure"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Overview of the Cambria Cluster / FTC Environment in a Kubernetes Environment"}),"\n",(0,i.jsx)(n.li,{children:"Preparation for the installation (Prerequisites)"}),"\n",(0,i.jsx)(n.li,{children:"Create and configure the Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Install Cambria Cluster and Cambria FTC on the Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Verify the installation is working properly"}),"\n",(0,i.jsx)(n.li,{children:"Test the Cambria Cluster / FTC applications"}),"\n",(0,i.jsx)(n.li,{children:"Update the Cambria Cluster / FTC applications on Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Delete a Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Quick Reference of Kubernetes Installation"}),"\n",(0,i.jsx)(n.li,{children:"Quick Reference of Important Kubernetes Components (URLs, template projects, test player, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Glossary of important terms"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,i.jsx)(n.h3,{id:"11-cambria-cluster--ftc-kubernetes-deployment",children:"1.1 Cambria Cluster / FTC Kubernetes Deployment"}),"\n",(0,i.jsx)(n.p,{children:"There are two major applications involved in this Kubernetes installation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Cambria Cluster"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Cambria FTC"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"cambria-cluster",children:"Cambria Cluster"}),"\n",(0,i.jsxs)(n.p,{children:["This deployment is recommended to run on ",(0,i.jsx)(n.strong,{children:"at least 3 nodes"})," (",(0,i.jsx)(n.code,{children:"replica = 3"}),") with a ",(0,i.jsx)(n.strong,{children:"LoadBalancer service"})," that exposes the application externally."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each Cambria Cluster pod is installed on its own node."}),"\n",(0,i.jsxs)(n.li,{children:["One pod acts as the ",(0,i.jsx)(n.strong,{children:"leader"}),", and the other two serve as ",(0,i.jsx)(n.strong,{children:"replicas"}),", allowing automatic failover."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.strong,{children:"Cambria Cluster pod"})," includes:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cambria Cluster"})," (application container)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Leader Elector"})," tool \u2013 designates the pod leader"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cambria FTC Autoscaler"})," tool \u2013 auto-deploys FTC workers based on job load:"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scaling Formula:"}),(0,i.jsx)(n.br,{}),"\n","Number of Nodes to Deploy = ",(0,i.jsx)(n.code,{children:"(Number of Queued Jobs + 2) / 3"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Additionally:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.strong,{children:"PostgreSQL database"})," pod is deployed per active Cambria Cluster pod."]}),"\n",(0,i.jsxs)(n.li,{children:["Databases are ",(0,i.jsx)(n.strong,{children:"replicated"})," for fault tolerance and data integrity."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"cambria-ftc",children:"Cambria FTC"}),"\n",(0,i.jsxs)(n.p,{children:["Capella\u2019s ",(0,i.jsx)(n.strong,{children:"Cambria FTC"})," deployment consists of ",(0,i.jsx)(n.strong,{children:"one or more nodes"}),", often using different instance types than the Cluster nodes."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FTC pods are responsible for executing encoding jobs."}),"\n",(0,i.jsxs)(n.li,{children:["Each pod is assigned its ",(0,i.jsx)(n.strong,{children:"own node"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.strong,{children:"Cambria FTC pod"})," includes:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cambria FTC"})," (application container)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Auto-Connect FTC"})," (dotnet tool) \u2013 performs:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pod discovery"}),"\n",(0,i.jsx)(n.li,{children:"Cluster identification"}),"\n",(0,i.jsx)(n.li,{children:"FTC-Cluster auto-connect logic"}),"\n",(0,i.jsx)(n.li,{children:"If no Cluster is found within ~20 minutes, the node is recycled"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pgcluster"})," \u2013 PostgreSQL container for job and state persistence (pod lifetime only)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"deployment-note",children:"Deployment Note"}),"\n",(0,i.jsxs)(n.p,{children:["Each node in the Kubernetes Cluster will either be running the ",(0,i.jsx)(n.strong,{children:"Cambria Cluster deployment"})," or the ",(0,i.jsx)(n.strong,{children:"Cambria FTC deployment"}),", but not both."]}),"\n",(0,i.jsx)(n.h3,{id:"12-resource-usage",children:"1.2 Resource Usage"}),"\n",(0,i.jsxs)(n.p,{children:["The resources used and their quantities will vary depending on requirements and environments.",(0,i.jsx)(n.br,{}),"\n","Below is general information about major resource usage. Other resources may also be required.",(0,i.jsx)(n.br,{}),"\n","Please consult AWS and ",(0,i.jsx)(n.code,{children:"eksctl"})," documentation for more details."]}),"\n",(0,i.jsx)(n.h4,{id:"reference-documentation",children:"Reference Documentation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/eks-deployment-options.html",children:"EKS Deployment Options"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eksctl.io/usage/creating-and-managing-clusters/",children:"eksctl: Creating and Managing Clusters"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eksctl.io/usage/vpc-networking/",children:"eksctl: VPC Networking"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/subnets.html",children:"EKS Subnet Best Practices"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AvailableIpPerENI.html",children:"AWS EC2: Available IPs per ENI"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/network-security.html",children:"EKS Network Security Best Practices"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"resource-overview",children:"Resource Overview"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Load Balancers"})}),(0,i.jsx)(n.td,{children:"- 0\u20133 Classic Load Balancers (Manager WebUI, Manager Web Server, Grafana)"})]})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["0\u20131 Network Load Balancer (Ingress)                                    |\n| ",(0,i.jsx)(n.strong,{children:"Nodes"}),"          | - ",(0,i.jsx)(n.code,{children:"X"})," Cambria Manager Instances (Default: 3)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Y"})," Cambria FTC Instances (Default max: 20)                            |\n| ",(0,i.jsx)(n.strong,{children:"Networking"}),"     | - 1 VPC (default)"]}),"\n",(0,i.jsx)(n.li,{children:"3 public subnets and 3 private subnets (2 subnets reserved)"}),"\n",(0,i.jsxs)(n.li,{children:["Default ",(0,i.jsx)(n.code,{children:"/16"})," CIDR"]}),"\n",(0,i.jsxs)(n.li,{children:["Each subnet: ",(0,i.jsx)(n.code,{children:"/19"})," CIDR                                                 |"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," For CIDR planning, refer to",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/networking.html",children:"EKS Best Practices: Networking"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"security-groups",children:"Security Groups"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Default: 1 security group for the ",(0,i.jsx)(n.strong,{children:"control plane"})]}),"\n",(0,i.jsxs)(n.li,{children:["Default: ",(0,i.jsx)(n.code,{children:"X"})," security groups \u2014 one per ",(0,i.jsx)(n.strong,{children:"node group"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"13-aws-machine-information-and-benchmark",children:"1.3 AWS Machine Information and Benchmark"}),"\n",(0,i.jsxs)(n.p,{children:["The following benchmark compares two AWS EC2 instance types.",(0,i.jsx)(n.br,{}),"\n","This information is current as of ",(0,i.jsx)(n.strong,{children:"September 2023"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f Benchmark results reflect workloads that involve read/write access to ",(0,i.jsx)(n.strong,{children:"AWS S3"}),", which affects transcoding speed."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"benchmark-job-configuration",children:"Benchmark Job Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Codec"}),(0,i.jsx)(n.th,{children:"Frame Rate"}),(0,i.jsx)(n.th,{children:"Resolution"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Source"})}),(0,i.jsx)(n.td,{children:"TS"}),(0,i.jsx)(n.td,{children:"H.264"}),(0,i.jsx)(n.td,{children:"30 fps, 1920\xd71080 @ 8 Mbps"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Output"})}),(0,i.jsx)(n.td,{children:"HLS/TS"}),(0,i.jsx)(n.td,{children:"H.264"}),(0,i.jsx)(n.td,{children:"29.97 fps"})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"1920\xd71080 @ 4 Mbps"}),"\n",(0,i.jsx)(n.li,{children:"1280\xd7720 @ 2.4 Mbps"}),"\n",(0,i.jsx)(n.li,{children:"640\xd7480 @ 0.8 Mbps"}),"\n",(0,i.jsx)(n.li,{children:"320\xd7240 @ 0.3 Mbps |"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"a-c6a4xlarge-amd-epyc-7r13",children:["a. ",(0,i.jsx)(n.code,{children:"c6a.4xlarge"})," [AMD EPYC 7R13]"]}),"\n",(0,i.jsx)(n.h5,{id:"machine-info",children:"Machine Info"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"RAM"}),(0,i.jsx)(n.th,{children:"CPUs"}),(0,i.jsx)(n.th,{children:"Storage"}),(0,i.jsx)(n.th,{children:"Network Performance"}),(0,i.jsx)(n.th,{children:"Cost/Hour"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"c6a.4xlarge"}),(0,i.jsx)(n.td,{children:"32 GB"}),(0,i.jsx)(n.td,{children:"16"}),(0,i.jsx)(n.td,{children:"Any"}),(0,i.jsx)(n.td,{children:"12.5 Gbps"}),(0,i.jsx)(n.td,{children:"$0.612"})]})})]}),"\n",(0,i.jsx)(n.h5,{id:"benchmark-results",children:"Benchmark Results"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Concurrent Jobs"}),(0,i.jsx)(n.th,{children:"Real-Time Speed"}),(0,i.jsx)(n.th,{children:"CPU Usage"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"- 0.73x RT per job (slower than real-time)"}),(0,i.jsx)(n.td,{})]})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Total throughput: 1.46x RT",(0,i.jsx)(n.br,{}),"\n","(\u2248 42 sec to transcode 1 min)          | 100%      |"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"b-c6a16xlarge-amd-epyc-7r13",children:["b. ",(0,i.jsx)(n.code,{children:"c6a.16xlarge"})," [AMD EPYC 7R13]"]}),"\n",(0,i.jsx)(n.h5,{id:"machine-info-1",children:"Machine Info"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"RAM"}),(0,i.jsx)(n.th,{children:"CPUs"}),(0,i.jsx)(n.th,{children:"Storage"}),(0,i.jsx)(n.th,{children:"Network Performance"}),(0,i.jsx)(n.th,{children:"Cost/Hour"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"c6a.16xlarge"}),(0,i.jsx)(n.td,{children:"128 GB"}),(0,i.jsx)(n.td,{children:"64"}),(0,i.jsx)(n.td,{children:"Any"}),(0,i.jsx)(n.td,{children:"25 Gbps"}),(0,i.jsx)(n.td,{children:"$2.448"})]})})]}),"\n",(0,i.jsx)(n.h5,{id:"benchmark-results-1",children:"Benchmark Results"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Concurrent Jobs"}),(0,i.jsx)(n.th,{children:"Real-Time Speed"}),(0,i.jsx)(n.th,{children:"CPU Usage"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"- 2.17x RT per job (faster than real-time)"}),(0,i.jsx)(n.td,{})]})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Total throughput: 4.34x RT",(0,i.jsx)(n.br,{}),"\n","(\u2248 21 sec to transcode 1 min)           | ~84%       |"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"benchmark-summary",children:"Benchmark Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:"c6a.16xlarge"})," instance provides significantly higher throughput due to increased compute resources."]}),"\n",(0,i.jsxs)(n.li,{children:["However, the ",(0,i.jsx)(n.strong,{children:"c6a.4xlarge"})," instance is ",(0,i.jsx)(n.strong,{children:"more cost-effective per hour"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"The choice between the two should consider both budget and throughput requirements."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"14-cambria-application-access",children:"1.4 Cambria Application Access"}),"\n",(0,i.jsx)(n.p,{children:"The Cambria applications can be accessed using the following methods:"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"141-external-access-via-tcp-load-balancer",children:"1.4.1 External Access via TCP Load Balancer"}),"\n",(0,i.jsx)(n.p,{children:"By default, Cambria installs with one TCP Load Balancer for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Manager WebUI + License Manager"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Web / REST API Server"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These load balancers are publicly reachable by IP or domain name with their configured ports."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cambria Manager WebUI:"})," ",(0,i.jsx)(n.code,{children:"https://44.33.212.155:8161"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cambria REST API:"})," ",(0,i.jsx)(n.code,{children:"https://121.121.121.121:8650/CambriaFC/v1/SystemInfo"})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\ud83d\udd04 You can enable or disable external access via TCP Load Balancer by editing the Helm configuration (see section 4.2).",(0,i.jsx)(n.br,{}),"\n","If disabled, you'll need to configure another access method below."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"142-http-ingress-via-reverse-proxy",children:"1.4.2 HTTP Ingress via Reverse Proxy"}),"\n",(0,i.jsx)(n.p,{children:"If you\u2019d rather use a purchased domain (e.g., from GoDaddy) or disable public IP access, you can expose services through an HTTP Ingress."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Only ",(0,i.jsx)(n.strong,{children:"one IP/domain name"})," is needed."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Traffic is routed by subdomain:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"webui.mydomain.com"})," \u2192 Cambria WebUI"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"api.mydomain.com"})," \u2192 Cambria Web Server / REST API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"monitoring.mydomain.com"})," \u2192 Grafana Dashboard"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u26a0\ufe0f Capella provides a default ingress hostname for testing. In production, you must configure your own hostname, SSL certificate, and domain settings (detailed later in this guide)."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"15-firewall-information",children:"1.5 Firewall Information"}),"\n",(0,i.jsx)(n.p,{children:"Default Kubernetes cluster setup includes basic virtual network firewalling. If using custom or more restrictive firewall rules, ensure the following ports are open:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Port"}),(0,i.jsx)(n.th,{children:"Protocol"}),(0,i.jsx)(n.th,{children:"Traffic Direction"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8650"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria Cluster REST API"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8161"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria Cluster WebUI"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8678"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria License Manager Web Server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8481"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria License Manager WebUI"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9100"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Prometheus Exporter for Cambria Cluster"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8648"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria FTC REST API"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3100"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Loki Logging Service"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3000"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Grafana Dashboard"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"443"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Capella Ingress"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u2014"}),(0,i.jsx)(n.td,{children:"TCP/UDP"}),(0,i.jsx)(n.td,{children:"Outbound"}),(0,i.jsx)(n.td,{children:"All outbound traffic"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Additionally, ensure outbound/inbound access for Cambria licensing domains:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Domain"}),(0,i.jsx)(n.th,{children:"Port"}),(0,i.jsx)(n.th,{children:"Protocol"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"api.cryptlex.com"})}),(0,i.jsx)(n.td,{children:"443"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"License Server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cryptlexapi.capellasystems.net"})}),(0,i.jsx)(n.td,{children:"8485"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"License Cache Server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cpfs.capellasystems.net"})}),(0,i.jsx)(n.td,{children:"8483"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"License Backup Server"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"2-prerequisites",children:"2. Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"The following steps must be completed before starting the deployment process."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"21-tools-kubectl-helm-eksctl-and-aws-cli",children:"2.1 Tools: Kubectl, Helm, Eksctl, and AWS CLI"}),"\n",(0,i.jsxs)(n.p,{children:["This guide uses ",(0,i.jsx)(n.code,{children:"curl"})," and ",(0,i.jsx)(n.code,{children:"unzip"})," to run commands and download required applications."]}),"\n",(0,i.jsx)(n.p,{children:"Install dependencies on Ubuntu:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update; sudo apt upgrade; sudo apt install curl unzip\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then download and prepare the deployment package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -o CambriaClusterKubernetesAWS_5_5_0.zip -L "https://www.dropbox.com/scl/fi/4dg2024wbbq0lx1qbnk8e/CambriaClusterKubernetesAWS_5_5_0.zip?rlkey=j0q7xgxv2v60x4bcwfoesd8nv&st=zfnff3f2&dl=1"\nunzip CambriaClusterKubernetesAWS_5_5_0.zip\nchmod +x *.sh\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Scripts are tested on ",(0,i.jsx)(n.strong,{children:"Ubuntu"}),". Other Linux distributions may work but are untested."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"211-installation",children:"2.1.1 Installation"}),"\n",(0,i.jsx)(n.p,{children:"There are two options to install Kubernetes tools:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 1: Use Provided Scripts"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./installKubeTools.sh\n./installKubeToolsAws.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Manual Installation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"Kubectl"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:"Helm"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eksctl.io/installation/",children:"Eksctl"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS CLI"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"212-verification",children:"2.1.2 Verification"}),"\n",(0,i.jsx)(n.p,{children:"Run the following to verify installations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl version --client\nhelm version\neksctl version\naws --version\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"22-create-and-configure-aws-permissions",children:"2.2 Create and Configure AWS Permissions"}),"\n",(0,i.jsx)(n.p,{children:"To create Kubernetes resources, IAM permissions must be configured."}),"\n",(0,i.jsx)(n.p,{children:"Run this to set your AWS account ID:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query "Account" --output text)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"221-create-custom-policies",children:"2.2.1 Create Custom Policies"}),"\n",(0,i.jsx)(n.p,{children:"Eksctl requires specific IAM policies. To create them:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createEksctlCustomAwsPolicies.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"If creation fails, verify the script and existing policies. Delete old ones if necessary."}),"\n",(0,i.jsxs)(n.p,{children:["For more details: ",(0,i.jsx)(n.a,{href:"https://eksctl.io/usage/minimum-iam-policies/",children:"Minimum eksctl IAM Policies"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"222-create-and-assign-eksctl-aws-role",children:"2.2.2 Create and Assign Eksctl AWS Role"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a role ",(0,i.jsx)(n.code,{children:"eksctl-user"})," with the following policies:"]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AmazonEC2FullAccess"}),"\n",(0,i.jsx)(n.li,{children:"AWSCloudFormationFullAccess"}),"\n",(0,i.jsx)(n.li,{children:"EksAllAccess"}),"\n",(0,i.jsx)(n.li,{children:"IamLimitedAccess"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Create the role via:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createEksctlClusterUserRole.sh eksctl-user\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Must have permissions to create roles and instance profiles."}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["On EC2, attach the new IAM role:\nGo to ",(0,i.jsx)(n.strong,{children:"Actions > Security > Modify IAM role"})," and choose ",(0,i.jsx)(n.code,{children:"eksctl-user-instance-profile"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3-create-kubernetes-cluster",children:"3. Create Kubernetes Cluster"}),"\n",(0,i.jsx)(n.p,{children:"This section describes how to create an EKS cluster and Cambria Cluster node group."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"31-create-aws-eks-cluster-and-node-group",children:"3.1 Create AWS EKS Cluster and Node Group"}),"\n",(0,i.jsx)(n.p,{children:"Recommendations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cambria Cluster"})," handles encoding job scheduling."]}),"\n",(0,i.jsxs)(n.li,{children:["Use at least ",(0,i.jsx)(n.strong,{children:"c7i.xlarge"})," for each node."]}),"\n",(0,i.jsxs)(n.li,{children:["Set node count to ",(0,i.jsx)(n.strong,{children:"3"})," for redundancy."]}),"\n",(0,i.jsx)(n.li,{children:"One node is active; the other two serve as failover."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 1: Set environment variables"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export CLUSTER_NAME=cambria-cluster\nexport REGION=us-west-2\nexport KUBEVERSION=1.32\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 2: Create the cluster"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl create cluster \\\n--name=$CLUSTER_NAME \\\n--region=$REGION \\\n--version=$KUBEVERSION \\\n--kubeconfig=./$CLUSTER_NAME-kubeconfig.yaml \\\n--node-private-networking \\\n--nodegroup-name=manager-nodes \\\n--with-oidc \\\n--node-ami-family=Ubuntu2204 \\\n--nodes=3 \\\n--instance-types=c7i.xlarge \\\n--vpc-cidr=10.0.0.0/16\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Capella has also tested AmazonLinux2, but it does not support GPU workloads.\nThe lowest CIDR tested by Capella is ",(0,i.jsx)(n.code,{children:"/19"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Run the following command to create the Kubernetes cluster using ",(0,i.jsx)(n.code,{children:"eksctl"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl create cluster \\\n  --name=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --version=$KUBEVERSION \\\n  --kubeconfig=./$CLUSTER_NAME-kubeconfig.yaml \\\n  --node-private-networking \\\n  --nodegroup-name=manager-nodes \\\n  --with-oidc \\\n  --node-ami-family=Ubuntu2204 \\\n  --nodes=3 \\\n  --instance-types=c7i.xlarge \\\n  --vpc-cidr=10.0.0.0/16\n3. Set kubeconfig as an Environment Variable\n\nexport KUBECONFIG=$CLUSTER_NAME-kubeconfig.yaml\n\n4. Verify Cluster Access\n\nkubectl get nodes\nExpected output should resemble:\n\npgsql\nCopy\nEdit\nNAME                                         STATUS   ROLES    AGE     VERSION\nip-10-0-12-44.us-west-2.compute.internal     Ready    <none>   118m    v1.32.0\nip-10-0-16-207.us-west-2.compute.internal    Ready    <none>   118m    v1.32.0\nip-10-0-22-84.us-west-2.compute.internal     Ready    <none>   118m    v1.32.0\n\u26a0\ufe0f If the output is different or an error occurs, verify deployment information, credentials, and permissions.\n\n3.2 Create EBS CSI Driver\nStep 1: Create IAM Role for CSI Plugin\nThis IAM role is required to allow the CSI plugin to manage EBS volumes.\n\neksctl create iamserviceaccount \\\n  --name=ebs-csi-controller-sa \\\n  --namespace=kube-system \\\n  --cluster=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --role-only \\\n  --attach-policy-arn=arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \\\n  --approve \\\n  --role-name=eksctl-ebs-csi-driver-role\n\ud83d\udd27 The role name (--role-name) must:\n\nStart with eksctl-\n\nBe unique to the cluster\n\nBe \u2264 64 characters\n\nStep 2: Install AWS EBS CSI Driver Addon\nbash\nCopy\nEdit\neksctl create addon \\\n  --name aws-ebs-csi-driver \\\n  --cluster=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --force \\\n  --service-account-role-arn=arn:aws:iam::$AWS_ACCOUNT_ID:role/eksctl-ebs-csi-driver-role\n\u26a0\ufe0f This step installs the AWS EBS CSI plugin.\nIt must be in Active status before continuing.\nIf this fails, consider re-creating the cluster as the safest option.\n\neksctl-ebs-csi-driver-role: the role name from the command in step 1\neksctl create addon \\\n--name aws-ebs-csi-driver \\\n--cluster=$CLUSTER_NAME \\\n--region=$REGION \\\n--force \\\n--service-account-role-arn=arn:aws:iam::$AWS_ACCOUNT_ID:role/eksctl-ebs-csi-driver-role\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var r=s(6540);const i={},t=r.createContext(i);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);