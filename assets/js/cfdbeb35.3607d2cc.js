"use strict";(self.webpackChunkcapella_documentation=self.webpackChunkcapella_documentation||[]).push([[3715],{1045:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"Cambria FTC/Installation Guides/Kubernetes/AWS/cambria-cluster-ftc-aws","title":"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes","description":"Document History","source":"@site/docs/Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS/index.md","sourceDirName":"Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS","slug":"/Cambria FTC/Installation Guides/Kubernetes/AWS/","permalink":"/docs/Cambria FTC/Installation Guides/Kubernetes/AWS/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"cambria-cluster-ftc-aws","title":"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes"},"sidebar":"FTCSidebar","next":{"title":"Cambria Cluster / FTC 5.5.0 - Terraform on Akamai Kubernetes","permalink":"/docs/Cambria FTC/Installation Guides/Kubernetes/Akamai/"}}');var i=s(4848),l=s(8453);const a={id:"cambria-cluster-ftc-aws",title:"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes"},t=void 0,c={},o=[{value:"Document History",id:"document-history",level:2},{value:"Limitations and Security Information",id:"limitations-and-security-information",level:3},{value:"\u26a0\ufe0f Important: Before You Begin",id:"\ufe0f-important-before-you-begin",level:2},{value:"\u26a0\ufe0f Critical Information: Read Before Proceeding with Installation",id:"\ufe0f-critical-information-read-before-proceeding-with-installation",level:2},{value:"Document Overview",id:"document-overview",level:2},{value:"Document Structure",id:"document-structure",level:3},{value:"1. Overview",id:"1-overview",level:2},{value:"1.1 Cambria Cluster / FTC Kubernetes Deployment",id:"11-cambria-cluster--ftc-kubernetes-deployment",level:3},{value:"Cambria Cluster",id:"cambria-cluster",level:3},{value:"Cambria FTC",id:"cambria-ftc",level:3},{value:"Deployment Note",id:"deployment-note",level:3},{value:"1.2 Resource Usage",id:"12-resource-usage",level:3},{value:"Reference Documentation:",id:"reference-documentation",level:4},{value:"Resource Overview",id:"resource-overview",level:4},{value:"Security Groups",id:"security-groups",level:4},{value:"1.3 AWS Machine Information and Benchmark",id:"13-aws-machine-information-and-benchmark",level:3},{value:"Benchmark Job Configuration",id:"benchmark-job-configuration",level:4},{value:"a. <code>c6a.4xlarge</code> [AMD EPYC 7R13]",id:"a-c6a4xlarge-amd-epyc-7r13",level:4},{value:"Machine Info",id:"machine-info",level:5},{value:"Benchmark Results",id:"benchmark-results",level:5},{value:"b. <code>c6a.16xlarge</code> [AMD EPYC 7R13]",id:"b-c6a16xlarge-amd-epyc-7r13",level:4},{value:"Machine Info",id:"machine-info-1",level:5},{value:"Benchmark Results",id:"benchmark-results-1",level:5},{value:"Benchmark Summary",id:"benchmark-summary",level:4},{value:"1.4 Cambria Application Access",id:"14-cambria-application-access",level:3},{value:"1.4.1 External Access via TCP Load Balancer",id:"141-external-access-via-tcp-load-balancer",level:4},{value:"1.4.2 HTTP Ingress via Reverse Proxy",id:"142-http-ingress-via-reverse-proxy",level:4},{value:"1.5 Firewall Information",id:"15-firewall-information",level:3},{value:"2. Prerequisites",id:"2-prerequisites",level:3},{value:"2.1 Tools: Kubectl, Helm, Eksctl, and AWS CLI",id:"21-tools-kubectl-helm-eksctl-and-aws-cli",level:4},{value:"2.1.1 Installation",id:"211-installation",level:5},{value:"2.1.2 Verification",id:"212-verification",level:5},{value:"2.2 Create and Configure AWS Permissions",id:"22-create-and-configure-aws-permissions",level:4},{value:"2.2.1 Create Custom Policies",id:"221-create-custom-policies",level:5},{value:"2.2.2 Create and Assign Eksctl AWS Role",id:"222-create-and-assign-eksctl-aws-role",level:5},{value:"3. Create Kubernetes Cluster",id:"3-create-kubernetes-cluster",level:3},{value:"3.1 Create AWS EKS Cluster and Node Group",id:"31-create-aws-eks-cluster-and-node-group",level:4},{value:"3.3 AWS IAM Permissions for FTC",id:"33-aws-iam-permissions-for-ftc",level:3},{value:"3.3.1 Create FTC IAM Role",id:"331-create-ftc-iam-role",level:3},{value:"3.3.2 Create FTC Autoscaler Roles",id:"332-create-ftc-autoscaler-roles",level:3},{value:"3.4 (Optional) Restricting Cambria FTC Encoder Designated Nodes via Exclusion Label",id:"34-optional-restricting-cambria-ftc-encoder-designated-nodes-via-exclusion-label",level:3},{value:"Overview",id:"overview",level:4},{value:"Steps",id:"steps",level:4},{value:"3.5 Create Cambria FTC Node Group(s)",id:"35-create-cambria-ftc-node-groups",level:3},{value:"3.6 GPU Operator for NVENC",id:"36-gpu-operator-for-nvenc",level:3},{value:"3.7 Performance Metrics and Logging",id:"37-performance-metrics-and-logging",level:3},{value:"4. Install Cambria Cluster, FTC, and Dependencies",id:"4-install-cambria-cluster-ftc-and-dependencies",level:2},{value:"4.1 Prerequisite: Deploy External Kubernetes Tools",id:"41-prerequisite-deploy-external-kubernetes-tools",level:3},{value:"4.1.1 Required Tools",id:"411-required-tools",level:4},{value:"4.1.2 (Optional) Ingress-Nginx",id:"412-optional-ingress-nginx",level:4},{value:"For Production or Public Domain/TLS Access",id:"for-production-or-public-domaintls-access",level:5},{value:"4.2 Creating and Editing Helm Configuration File",id:"42-creating-and-editing-helm-configuration-file",level:3},{value:"Steps:",id:"steps-1",level:4},{value:"Key Settings:",id:"key-settings",level:4},{value:"5. Verify Cambria FTC / Cluster Installation",id:"5-verify-cambria-ftc--cluster-installation",level:2},{value:"5.1. Verify Cambria Cluster Deployment",id:"51-verify-cambria-cluster-deployment",level:3},{value:"5.2. Verify Cambria FTC Deployment",id:"52-verify-cambria-ftc-deployment",level:3},{value:"5.3. Verify Applications are Accessible",id:"53-verify-applications-are-accessible",level:3},{value:"5.3.1. Cambria Cluster WebUI",id:"531-cambria-cluster-webui",level:4},{value:"5.3.2. Cambria Cluster REST API",id:"532-cambria-cluster-rest-api",level:2},{value:"5.3.3. Cambria Ingress",id:"533-cambria-ingress",level:2},{value:"5.3.3.1. Get the Ingress Endpoints",id:"5331-get-the-ingress-endpoints",level:3},{value:"5.3.3.2. Test Ingress Endpoints",id:"5332-test-ingress-endpoints",level:3},{value:"5.3.4. Cambria License",id:"534-cambria-license",level:2},{value:"6. Testing Cambria FTC / Cluster",id:"6-testing-cambria-ftc--cluster",level:2},{value:"7. Updating / Upgrading Cambria Cluster / FTC",id:"7-updating--upgrading-cambria-cluster--ftc",level:2},{value:"7.1. Option 1: Normal Upgrade via Helm Upgrade",id:"71-option-1-normal-upgrade-via-helm-upgrade",level:3},{value:"7.2. Option 2: Upgrade via Cambria Cluster Reinstallation",id:"72-option-2-upgrade-via-cambria-cluster-reinstallation",level:3},{value:"7.3. Upgrade Verification",id:"73-upgrade-verification",level:3},{value:"8. Deleting Kubernetes Cluster",id:"8-deleting-kubernetes-cluster",level:2},{value:"9. Quick Reference: Installation, Testing, and Teardown",id:"9-quick-reference-installation-testing-and-teardown",level:2},{value:"9.1. Installation (Deploy from Linux to AWS Kubernetes)",id:"91-installation-deploy-from-linux-to-aws-kubernetes",level:3},{value:"9.1.1. Prerequisites",id:"911-prerequisites",level:4},{value:"9.1.2. IAM Administrator Required Steps",id:"912-iam-administrator-required-steps",level:4},{value:"9.1.3. Installation",id:"913-installation",level:4},{value:"9.2. Upgrades and Teardown",id:"92-upgrades-and-teardown",level:3},{value:"9.2.1. Cambria FTC/Cluster and/or Kubernetes Cluster Upgrades",id:"921-cambria-ftccluster-andor-kubernetes-cluster-upgrades",level:4},{value:"9.2.2. Cambria FTC | Cluster Uninstall",id:"922-cambria-ftc--cluster-uninstall",level:4},{value:"9.2.3. Kubernetes Cluster Teardown",id:"923-kubernetes-cluster-teardown",level:4},{value:"10. Quick Reference: Helpful Commands/Info for After Installation",id:"10-quick-reference-helpful-commandsinfo-for-after-installation",level:2},{value:"AWS Kubernetes Kubeconfig File",id:"aws-kubernetes-kubeconfig-file",level:3},{value:"Cambria Cluster WebUI",id:"cambria-cluster-webui",level:3},{value:"Cambria Cluster REST API",id:"cambria-cluster-rest-api",level:3},{value:"Leader Cambria Cluster Pod",id:"leader-cambria-cluster-pod",level:3},{value:"Cambria FTC Instance External IP",id:"cambria-ftc-instance-external-ip",level:3},{value:"Remote Access to Kubernetes Pod",id:"remote-access-to-kubernetes-pod",level:2},{value:"Extracting Cambria Logs",id:"extracting-cambria-logs",level:2},{value:"Copy Files to Cambria Pods",id:"copy-files-to-cambria-pods",level:2},{value:"Restarting Pods",id:"restarting-pods",level:2},{value:"Find the ARN of a Role",id:"find-the-arn-of-a-role",level:2},{value:"11. Glossary",id:"11-glossary",level:2},{value:"11.1 Kubernetes",id:"111-kubernetes",level:3},{value:"11.2 Third-Party Tools",id:"112-third-party-tools",level:3},{value:"11.3 Capella Applications",id:"113-capella-applications",level:3},{value:"Troubleshooting FTC Autoscaler",id:"troubleshooting-ftc-autoscaler",level:2},{value:"No Instances Are Being Deployed",id:"no-instances-are-being-deployed",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"document-history",children:"Document History"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Date"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.4.0"}),(0,i.jsx)(n.td,{children:"10/03/2024"}),(0,i.jsx)(n.td,{children:"Updated for release 5.4.0.21627 (Linux)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.5.0"}),(0,i.jsx)(n.td,{children:"04/11/2025"}),(0,i.jsx)(n.td,{children:"Updated for release 5.5.0.23529 (Linux)"})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Download the online version of this document for the latest information and latest files. Always download the latest files."})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Do not move forward with the installation process if you do not agree with the End User License Agreement (EULA) for our products.",(0,i.jsx)(n.br,{}),"\n","You can download and read the EULA for Cambria FTC, Cambria Cluster, and Cambria License Manager from the links below:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/1wg7ee7a59kzi8h/EULA_Cambria_License_Manager.pdf?dl=0",children:"Cambria License Manager EULA"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/oemlax63aatjjiw/EULA_Cluster.pdf?dl=0",children:"Cambria Cluster EULA"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/ualv9usxsowh6m2/EULA_FTC.pdf?dl=0",children:"Cambria FTC EULA"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"limitations-and-security-information",children:"Limitations and Security Information"}),"\n",(0,i.jsx)(n.p,{children:"Cambria FTC, Cluster, and License Manager are installed on Linux Docker containers. Limitations and security checks done for this version are included in our general Linux Documents below:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/0rvskhpqtla6dffhbfli5/Linux_Cambria_Cluster_and_FTC_5_5_0_Guide.pdf?rlkey=ngryjzox121ow5fgbc4y8n2yd",children:"Linux Cambria Cluster and FTC 5.5.0 Guide"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," These documents are for informational use only. The setup for Kubernetes starts in section 3. Create Kubernetes Cluster.",(0,i.jsx)(n.br,{}),"\n","This document references Kubernetes version 1.32.1 only."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-important-before-you-begin",children:"\u26a0\ufe0f Important: Before You Begin"}),"\n",(0,i.jsx)(n.p,{children:"PDF documents have a copy/paste issue. For best results, download this document and any referenced PDF documents in this guide and open them in a PDF viewer such as Adobe Acrobat."}),"\n",(0,i.jsx)(n.p,{children:"For commands that are in more than one line, copy each line one by one and check that the copied command matches the one in the document."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-critical-information-read-before-proceeding-with-installation",children:"\u26a0\ufe0f Critical Information: Read Before Proceeding with Installation"}),"\n",(0,i.jsx)(n.p,{children:"Before starting the installation, carefully review the following considerations. Skipping this section may result in errors, failed deployments, or misconfigurations."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"A New Kubernetes Cluster Will Be Deployed"}),(0,i.jsx)(n.br,{}),"\n","\u25cf The installation process creates a brand-new Kubernetes cluster to keep the Cambria ecosystem isolated from other applications."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Default Installation is Non-Secure"}),(0,i.jsx)(n.br,{}),"\n","\u25cf The guide covers installation with default settings in an open environment (not secure).",(0,i.jsx)(n.br,{}),"\n","\u25cf If you require a secure or customized setup, you will need AWS expertise, which is not covered in this guide.",(0,i.jsx)(n.br,{}),"\n","\u25cf Firewall information is provided in section 1.5. Firewall Information"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Understand Your Transcoding Requirements"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Know your expected transcoding volume, input/output specs, and whether a GPU is needed.",(0,i.jsx)(n.br,{}),"\n","\u25cf Refer to section 1.3. AWS EC2 Instance Information and Benchmark for guidelines on machine requirements."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Administrative Rights Required"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Many of the steps in this guide require administrative rights to AWS for adding permissions and performing other administrative functions of that sort."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check AWS Account Quota"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Ensure the AWS account has sufficient quota to deploy Kubernetes resources.",(0,i.jsx)(n.br,{}),"\n","\u25cf See section 1.2. Resource Usage for estimated resource requirements."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"A Separate Linux Machine is Required"}),(0,i.jsx)(n.br,{}),"\n","\u25cf A dedicated Linux machine (preferably Ubuntu) is needed to deploy Kubernetes.",(0,i.jsx)(n.br,{}),"\n","\u25cf Keeping Kubernetes tools and configuration files on a dedicated system is strongly recommended."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify Region-Specific Resource Availability"}),(0,i.jsx)(n.br,{}),"\n","\u25cf Not all AWS regions support the same resources (e.g., GPU availability varies by region).",(0,i.jsx)(n.br,{}),"\n","\u25cf Consult AWS documentation to confirm available resources in your desired region."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"document-overview",children:"Document Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The purpose of this document is to provide a walkthrough of the installation and initial testing process of the ",(0,i.jsx)(n.strong,{children:"Cambria Cluster"})," and ",(0,i.jsx)(n.strong,{children:"Cambria FTC"})," applications in a Kubernetes environment."]}),"\n",(0,i.jsx)(n.h3,{id:"document-structure",children:"Document Structure"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Overview of the Cambria Cluster / FTC Environment in a Kubernetes Environment"}),"\n",(0,i.jsx)(n.li,{children:"Preparation for the installation (Prerequisites)"}),"\n",(0,i.jsx)(n.li,{children:"Create and configure the Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Install Cambria Cluster and Cambria FTC on the Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Verify the installation is working properly"}),"\n",(0,i.jsx)(n.li,{children:"Test the Cambria Cluster / FTC applications"}),"\n",(0,i.jsx)(n.li,{children:"Update the Cambria Cluster / FTC applications on Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Delete a Kubernetes Cluster"}),"\n",(0,i.jsx)(n.li,{children:"Quick Reference of Kubernetes Installation"}),"\n",(0,i.jsx)(n.li,{children:"Quick Reference of Important Kubernetes Components (URLs, template projects, test player, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Glossary of important terms"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,i.jsx)(n.h3,{id:"11-cambria-cluster--ftc-kubernetes-deployment",children:"1.1 Cambria Cluster / FTC Kubernetes Deployment"}),"\n",(0,i.jsx)(n.p,{children:"There are two major applications involved in this Kubernetes installation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Cambria Cluster"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Cambria FTC"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"cambria-cluster",children:"Cambria Cluster"}),"\n",(0,i.jsxs)(n.p,{children:["This deployment is recommended to run on ",(0,i.jsx)(n.strong,{children:"at least 3 nodes"})," (",(0,i.jsx)(n.code,{children:"replica = 3"}),") with a ",(0,i.jsx)(n.strong,{children:"LoadBalancer service"})," that exposes the application externally."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each Cambria Cluster pod is installed on its own node."}),"\n",(0,i.jsxs)(n.li,{children:["One pod acts as the ",(0,i.jsx)(n.strong,{children:"leader"}),", and the other two serve as ",(0,i.jsx)(n.strong,{children:"replicas"}),", allowing automatic failover."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.strong,{children:"Cambria Cluster pod"})," includes:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cambria Cluster"})," (application container)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Leader Elector"})," tool \u2013 designates the pod leader"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cambria FTC Autoscaler"})," tool \u2013 auto-deploys FTC workers based on job load:"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scaling Formula:"}),(0,i.jsx)(n.br,{}),"\n","Number of Nodes to Deploy = ",(0,i.jsx)(n.code,{children:"(Number of Queued Jobs + 2) / 3"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Additionally:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.strong,{children:"PostgreSQL database"})," pod is deployed per active Cambria Cluster pod."]}),"\n",(0,i.jsxs)(n.li,{children:["Databases are ",(0,i.jsx)(n.strong,{children:"replicated"})," for fault tolerance and data integrity."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"cambria-ftc",children:"Cambria FTC"}),"\n",(0,i.jsxs)(n.p,{children:["Capella\u2019s ",(0,i.jsx)(n.strong,{children:"Cambria FTC"})," deployment consists of ",(0,i.jsx)(n.strong,{children:"one or more nodes"}),", often using different instance types than the Cluster nodes."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FTC pods are responsible for executing encoding jobs."}),"\n",(0,i.jsxs)(n.li,{children:["Each pod is assigned its ",(0,i.jsx)(n.strong,{children:"own node"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.strong,{children:"Cambria FTC pod"})," includes:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Cambria FTC"})," (application container)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Auto-Connect FTC"})," (dotnet tool) \u2013 performs:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pod discovery"}),"\n",(0,i.jsx)(n.li,{children:"Cluster identification"}),"\n",(0,i.jsx)(n.li,{children:"FTC-Cluster auto-connect logic"}),"\n",(0,i.jsx)(n.li,{children:"If no Cluster is found within ~20 minutes, the node is recycled"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pgcluster"})," \u2013 PostgreSQL container for job and state persistence (pod lifetime only)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"deployment-note",children:"Deployment Note"}),"\n",(0,i.jsxs)(n.p,{children:["Each node in the Kubernetes Cluster will either be running the ",(0,i.jsx)(n.strong,{children:"Cambria Cluster deployment"})," or the ",(0,i.jsx)(n.strong,{children:"Cambria FTC deployment"}),", but not both."]}),"\n",(0,i.jsx)(n.h3,{id:"12-resource-usage",children:"1.2 Resource Usage"}),"\n",(0,i.jsxs)(n.p,{children:["The resources used and their quantities will vary depending on requirements and environments.",(0,i.jsx)(n.br,{}),"\n","Below is general information about major resource usage. Other resources may also be required.",(0,i.jsx)(n.br,{}),"\n","Please consult AWS and ",(0,i.jsx)(n.code,{children:"eksctl"})," documentation for more details."]}),"\n",(0,i.jsx)(n.h4,{id:"reference-documentation",children:"Reference Documentation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/eks-deployment-options.html",children:"EKS Deployment Options"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eksctl.io/usage/creating-and-managing-clusters/",children:"eksctl: Creating and Managing Clusters"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eksctl.io/usage/vpc-networking/",children:"eksctl: VPC Networking"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/subnets.html",children:"EKS Subnet Best Practices"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AvailableIpPerENI.html",children:"AWS EC2: Available IPs per ENI"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/network-security.html",children:"EKS Network Security Best Practices"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"resource-overview",children:"Resource Overview"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Load Balancers"})}),(0,i.jsx)(n.td,{children:"- 0\u20133 Classic Load Balancers (Manager WebUI, Manager Web Server, Grafana)"})]})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["0\u20131 Network Load Balancer (Ingress)                                    |\n| ",(0,i.jsx)(n.strong,{children:"Nodes"}),"          | - ",(0,i.jsx)(n.code,{children:"X"})," Cambria Manager Instances (Default: 3)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Y"})," Cambria FTC Instances (Default max: 20)                            |\n| ",(0,i.jsx)(n.strong,{children:"Networking"}),"     | - 1 VPC (default)"]}),"\n",(0,i.jsx)(n.li,{children:"3 public subnets and 3 private subnets (2 subnets reserved)"}),"\n",(0,i.jsxs)(n.li,{children:["Default ",(0,i.jsx)(n.code,{children:"/16"})," CIDR"]}),"\n",(0,i.jsxs)(n.li,{children:["Each subnet: ",(0,i.jsx)(n.code,{children:"/19"})," CIDR                                                 |"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," For CIDR planning, refer to",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/networking.html",children:"EKS Best Practices: Networking"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"security-groups",children:"Security Groups"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Default: 1 security group for the ",(0,i.jsx)(n.strong,{children:"control plane"})]}),"\n",(0,i.jsxs)(n.li,{children:["Default: ",(0,i.jsx)(n.code,{children:"X"})," security groups \u2014 one per ",(0,i.jsx)(n.strong,{children:"node group"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"13-aws-machine-information-and-benchmark",children:"1.3 AWS Machine Information and Benchmark"}),"\n",(0,i.jsxs)(n.p,{children:["The following benchmark compares two AWS EC2 instance types.",(0,i.jsx)(n.br,{}),"\n","This information is current as of ",(0,i.jsx)(n.strong,{children:"September 2023"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f Benchmark results reflect workloads that involve read/write access to ",(0,i.jsx)(n.strong,{children:"AWS S3"}),", which affects transcoding speed."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"benchmark-job-configuration",children:"Benchmark Job Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Codec"}),(0,i.jsx)(n.th,{children:"Frame Rate"}),(0,i.jsx)(n.th,{children:"Resolution"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Source"})}),(0,i.jsx)(n.td,{children:"TS"}),(0,i.jsx)(n.td,{children:"H.264"}),(0,i.jsx)(n.td,{children:"30 fps, 1920\xd71080 @ 8 Mbps"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Output"})}),(0,i.jsx)(n.td,{children:"HLS/TS"}),(0,i.jsx)(n.td,{children:"H.264"}),(0,i.jsx)(n.td,{children:"29.97 fps"})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"1920\xd71080 @ 4 Mbps"}),"\n",(0,i.jsx)(n.li,{children:"1280\xd7720 @ 2.4 Mbps"}),"\n",(0,i.jsx)(n.li,{children:"640\xd7480 @ 0.8 Mbps"}),"\n",(0,i.jsx)(n.li,{children:"320\xd7240 @ 0.3 Mbps |"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"a-c6a4xlarge-amd-epyc-7r13",children:["a. ",(0,i.jsx)(n.code,{children:"c6a.4xlarge"})," [AMD EPYC 7R13]"]}),"\n",(0,i.jsx)(n.h5,{id:"machine-info",children:"Machine Info"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"RAM"}),(0,i.jsx)(n.th,{children:"CPUs"}),(0,i.jsx)(n.th,{children:"Storage"}),(0,i.jsx)(n.th,{children:"Network Performance"}),(0,i.jsx)(n.th,{children:"Cost/Hour"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"c6a.4xlarge"}),(0,i.jsx)(n.td,{children:"32 GB"}),(0,i.jsx)(n.td,{children:"16"}),(0,i.jsx)(n.td,{children:"Any"}),(0,i.jsx)(n.td,{children:"12.5 Gbps"}),(0,i.jsx)(n.td,{children:"$0.612"})]})})]}),"\n",(0,i.jsx)(n.h5,{id:"benchmark-results",children:"Benchmark Results"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Concurrent Jobs"}),(0,i.jsx)(n.th,{children:"Real-Time Speed"}),(0,i.jsx)(n.th,{children:"CPU Usage"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"- 0.73x RT per job (slower than real-time)"}),(0,i.jsx)(n.td,{})]})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Total throughput: 1.46x RT",(0,i.jsx)(n.br,{}),"\n","(\u2248 42 sec to transcode 1 min)          | 100%      |"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h4,{id:"b-c6a16xlarge-amd-epyc-7r13",children:["b. ",(0,i.jsx)(n.code,{children:"c6a.16xlarge"})," [AMD EPYC 7R13]"]}),"\n",(0,i.jsx)(n.h5,{id:"machine-info-1",children:"Machine Info"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"RAM"}),(0,i.jsx)(n.th,{children:"CPUs"}),(0,i.jsx)(n.th,{children:"Storage"}),(0,i.jsx)(n.th,{children:"Network Performance"}),(0,i.jsx)(n.th,{children:"Cost/Hour"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"c6a.16xlarge"}),(0,i.jsx)(n.td,{children:"128 GB"}),(0,i.jsx)(n.td,{children:"64"}),(0,i.jsx)(n.td,{children:"Any"}),(0,i.jsx)(n.td,{children:"25 Gbps"}),(0,i.jsx)(n.td,{children:"$2.448"})]})})]}),"\n",(0,i.jsx)(n.h5,{id:"benchmark-results-1",children:"Benchmark Results"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Concurrent Jobs"}),(0,i.jsx)(n.th,{children:"Real-Time Speed"}),(0,i.jsx)(n.th,{children:"CPU Usage"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"- 2.17x RT per job (faster than real-time)"}),(0,i.jsx)(n.td,{})]})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Total throughput: 4.34x RT",(0,i.jsx)(n.br,{}),"\n","(\u2248 21 sec to transcode 1 min)           | ~84%       |"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"benchmark-summary",children:"Benchmark Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:"c6a.16xlarge"})," instance provides significantly higher throughput due to increased compute resources."]}),"\n",(0,i.jsxs)(n.li,{children:["However, the ",(0,i.jsx)(n.strong,{children:"c6a.4xlarge"})," instance is ",(0,i.jsx)(n.strong,{children:"more cost-effective per hour"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"The choice between the two should consider both budget and throughput requirements."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"14-cambria-application-access",children:"1.4 Cambria Application Access"}),"\n",(0,i.jsx)(n.p,{children:"The Cambria applications can be accessed using the following methods:"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"141-external-access-via-tcp-load-balancer",children:"1.4.1 External Access via TCP Load Balancer"}),"\n",(0,i.jsx)(n.p,{children:"By default, Cambria installs with one TCP Load Balancer for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Manager WebUI + License Manager"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Web / REST API Server"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These load balancers are publicly reachable by IP or domain name with their configured ports."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cambria Manager WebUI:"})," ",(0,i.jsx)(n.code,{children:"https://44.33.212.155:8161"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cambria REST API:"})," ",(0,i.jsx)(n.code,{children:"https://121.121.121.121:8650/CambriaFC/v1/SystemInfo"})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\ud83d\udd04 You can enable or disable external access via TCP Load Balancer by editing the Helm configuration (see section 4.2).",(0,i.jsx)(n.br,{}),"\n","If disabled, you'll need to configure another access method below."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"142-http-ingress-via-reverse-proxy",children:"1.4.2 HTTP Ingress via Reverse Proxy"}),"\n",(0,i.jsx)(n.p,{children:"If you\u2019d rather use a purchased domain (e.g., from GoDaddy) or disable public IP access, you can expose services through an HTTP Ingress."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Only ",(0,i.jsx)(n.strong,{children:"one IP/domain name"})," is needed."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Traffic is routed by subdomain:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"webui.mydomain.com"})," \u2192 Cambria WebUI"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"api.mydomain.com"})," \u2192 Cambria Web Server / REST API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"monitoring.mydomain.com"})," \u2192 Grafana Dashboard"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u26a0\ufe0f Capella provides a default ingress hostname for testing. In production, you must configure your own hostname, SSL certificate, and domain settings (detailed later in this guide)."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"15-firewall-information",children:"1.5 Firewall Information"}),"\n",(0,i.jsx)(n.p,{children:"Default Kubernetes cluster setup includes basic virtual network firewalling. If using custom or more restrictive firewall rules, ensure the following ports are open:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Port"}),(0,i.jsx)(n.th,{children:"Protocol"}),(0,i.jsx)(n.th,{children:"Traffic Direction"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8650"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria Cluster REST API"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8161"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria Cluster WebUI"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8678"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria License Manager Web Server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8481"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria License Manager WebUI"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9100"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Prometheus Exporter for Cambria Cluster"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8648"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Cambria FTC REST API"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3100"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Loki Logging Service"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3000"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Grafana Dashboard"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"443"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"Inbound"}),(0,i.jsx)(n.td,{children:"Capella Ingress"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u2014"}),(0,i.jsx)(n.td,{children:"TCP/UDP"}),(0,i.jsx)(n.td,{children:"Outbound"}),(0,i.jsx)(n.td,{children:"All outbound traffic"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Additionally, ensure outbound/inbound access for Cambria licensing domains:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Domain"}),(0,i.jsx)(n.th,{children:"Port"}),(0,i.jsx)(n.th,{children:"Protocol"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"api.cryptlex.com"})}),(0,i.jsx)(n.td,{children:"443"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"License Server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cryptlexapi.capellasystems.net"})}),(0,i.jsx)(n.td,{children:"8485"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"License Cache Server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cpfs.capellasystems.net"})}),(0,i.jsx)(n.td,{children:"8483"}),(0,i.jsx)(n.td,{children:"TCP"}),(0,i.jsx)(n.td,{children:"License Backup Server"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"2-prerequisites",children:"2. Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"The following steps must be completed before starting the deployment process."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"21-tools-kubectl-helm-eksctl-and-aws-cli",children:"2.1 Tools: Kubectl, Helm, Eksctl, and AWS CLI"}),"\n",(0,i.jsxs)(n.p,{children:["This guide uses ",(0,i.jsx)(n.code,{children:"curl"})," and ",(0,i.jsx)(n.code,{children:"unzip"})," to run commands and download required applications."]}),"\n",(0,i.jsx)(n.p,{children:"Install dependencies on Ubuntu:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update; sudo apt upgrade; sudo apt install curl unzip\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then download and prepare the deployment package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -o CambriaClusterKubernetesAWS_5_5_0.zip -L "https://www.dropbox.com/scl/fi/4dg2024wbbq0lx1qbnk8e/CambriaClusterKubernetesAWS_5_5_0.zip?rlkey=j0q7xgxv2v60x4bcwfoesd8nv&st=zfnff3f2&dl=1"\nunzip CambriaClusterKubernetesAWS_5_5_0.zip\nchmod +x *.sh\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Scripts are tested on ",(0,i.jsx)(n.strong,{children:"Ubuntu"}),". Other Linux distributions may work but are untested."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"211-installation",children:"2.1.1 Installation"}),"\n",(0,i.jsx)(n.p,{children:"There are two options to install Kubernetes tools:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 1: Use Provided Scripts"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./installKubeTools.sh\n./installKubeToolsAws.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Manual Installation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"Kubectl"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:"Helm"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eksctl.io/installation/",children:"Eksctl"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS CLI"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"212-verification",children:"2.1.2 Verification"}),"\n",(0,i.jsx)(n.p,{children:"Run the following to verify installations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl version --client\nhelm version\neksctl version\naws --version\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"22-create-and-configure-aws-permissions",children:"2.2 Create and Configure AWS Permissions"}),"\n",(0,i.jsx)(n.p,{children:"To create Kubernetes resources, IAM permissions must be configured."}),"\n",(0,i.jsx)(n.p,{children:"Run this to set your AWS account ID:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query "Account" --output text)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"221-create-custom-policies",children:"2.2.1 Create Custom Policies"}),"\n",(0,i.jsx)(n.p,{children:"Eksctl requires specific IAM policies. To create them:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createEksctlCustomAwsPolicies.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"If creation fails, verify the script and existing policies. Delete old ones if necessary."}),"\n",(0,i.jsxs)(n.p,{children:["For more details: ",(0,i.jsx)(n.a,{href:"https://eksctl.io/usage/minimum-iam-policies/",children:"Minimum eksctl IAM Policies"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"222-create-and-assign-eksctl-aws-role",children:"2.2.2 Create and Assign Eksctl AWS Role"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a role ",(0,i.jsx)(n.code,{children:"eksctl-user"})," with the following policies:"]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AmazonEC2FullAccess"}),"\n",(0,i.jsx)(n.li,{children:"AWSCloudFormationFullAccess"}),"\n",(0,i.jsx)(n.li,{children:"EksAllAccess"}),"\n",(0,i.jsx)(n.li,{children:"IamLimitedAccess"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Create the role via:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createEksctlClusterUserRole.sh eksctl-user\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Must have permissions to create roles and instance profiles."}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["On EC2, attach the new IAM role:\nGo to ",(0,i.jsx)(n.strong,{children:"Actions > Security > Modify IAM role"})," and choose ",(0,i.jsx)(n.code,{children:"eksctl-user-instance-profile"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3-create-kubernetes-cluster",children:"3. Create Kubernetes Cluster"}),"\n",(0,i.jsx)(n.p,{children:"This section describes how to create an EKS cluster and Cambria Cluster node group."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"31-create-aws-eks-cluster-and-node-group",children:"3.1 Create AWS EKS Cluster and Node Group"}),"\n",(0,i.jsx)(n.p,{children:"Recommendations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cambria Cluster"})," handles encoding job scheduling."]}),"\n",(0,i.jsxs)(n.li,{children:["Use at least ",(0,i.jsx)(n.strong,{children:"c7i.xlarge"})," for each node."]}),"\n",(0,i.jsxs)(n.li,{children:["Set node count to ",(0,i.jsx)(n.strong,{children:"3"})," for redundancy."]}),"\n",(0,i.jsx)(n.li,{children:"One node is active; the other two serve as failover."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 1: Set environment variables"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export CLUSTER_NAME=cambria-cluster\nexport REGION=us-west-2\nexport KUBEVERSION=1.32\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 2: Create the cluster"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl create cluster \\\n--name=$CLUSTER_NAME \\\n--region=$REGION \\\n--version=$KUBEVERSION \\\n--kubeconfig=./$CLUSTER_NAME-kubeconfig.yaml \\\n--node-private-networking \\\n--nodegroup-name=manager-nodes \\\n--with-oidc \\\n--node-ami-family=Ubuntu2204 \\\n--nodes=3 \\\n--instance-types=c7i.xlarge \\\n--vpc-cidr=10.0.0.0/16\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Capella has also tested AmazonLinux2, but it does not support GPU workloads.\nThe lowest CIDR tested by Capella is ",(0,i.jsx)(n.code,{children:"/19"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Run the following command to create the Kubernetes cluster using ",(0,i.jsx)(n.code,{children:"eksctl"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl create cluster \\\n  --name=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --version=$KUBEVERSION \\\n  --kubeconfig=./$CLUSTER_NAME-kubeconfig.yaml \\\n  --node-private-networking \\\n  --nodegroup-name=manager-nodes \\\n  --with-oidc \\\n  --node-ami-family=Ubuntu2204 \\\n  --nodes=3 \\\n  --instance-types=c7i.xlarge \\\n  --vpc-cidr=10.0.0.0/16\n3. Set kubeconfig as an Environment Variable\n\nexport KUBECONFIG=$CLUSTER_NAME-kubeconfig.yaml\n\n4. Verify Cluster Access\n\nkubectl get nodes\nExpected output should resemble:\n\npgsql\n\nNAME                                         STATUS   ROLES    AGE     VERSION\nip-10-0-12-44.us-west-2.compute.internal     Ready    <none>   118m    v1.32.0\nip-10-0-16-207.us-west-2.compute.internal    Ready    <none>   118m    v1.32.0\nip-10-0-22-84.us-west-2.compute.internal     Ready    <none>   118m    v1.32.0\n\u26a0\ufe0f If the output is different or an error occurs, verify deployment information, credentials, and permissions.\n\n3.2 Create EBS CSI Driver\nStep 1: Create IAM Role for CSI Plugin\nThis IAM role is required to allow the CSI plugin to manage EBS volumes.\n\neksctl create iamserviceaccount \\\n  --name=ebs-csi-controller-sa \\\n  --namespace=kube-system \\\n  --cluster=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --role-only \\\n  --attach-policy-arn=arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \\\n  --approve \\\n  --role-name=eksctl-ebs-csi-driver-role\n\ud83d\udd27 The role name (--role-name) must:\n\nStart with eksctl-\n\nBe unique to the cluster\n\nBe \u2264 64 characters\n\nStep 2: Install AWS EBS CSI Driver Addon\n\neksctl create addon \\\n  --name aws-ebs-csi-driver \\\n  --cluster=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --force \\\n  --service-account-role-arn=arn:aws:iam::$AWS_ACCOUNT_ID:role/eksctl-ebs-csi-driver-role\n\u26a0\ufe0f This step installs the AWS EBS CSI plugin.\nIt must be in Active status before continuing.\nIf this fails, consider re-creating the cluster as the safest option.\n\neksctl-ebs-csi-driver-role: the role name from the command in step 1\neksctl create addon \\\n--name aws-ebs-csi-driver \\\n--cluster=$CLUSTER_NAME \\\n--region=$REGION \\\n--force \\\n--service-account-role-arn=arn:aws:iam::$AWS_ACCOUNT_ID:role/eksctl-ebs-csi-driver-role\n"})}),"\n",(0,i.jsx)(n.p,{children:"un the following command to verify the AWS EBS CSI Driver plugin state:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl get addon   --name=aws-ebs-csi-driver   --cluster=$CLUSTER_NAME   --region=$REGION\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsxs)(n.strong,{children:["DO NOT proceed to the next step until the plugin status shows ",(0,i.jsx)(n.code,{children:"ACTIVE"}),"."]})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"33-aws-iam-permissions-for-ftc",children:"3.3 AWS IAM Permissions for FTC"}),"\n",(0,i.jsxs)(n.p,{children:["Certain permissions must be granted for Cambria FTC to access S3 and use the FTC autoscaler.",(0,i.jsx)(n.br,{}),"\n","This requires ",(0,i.jsx)(n.strong,{children:"IAM administrative privileges"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u2139\ufe0f These steps can be done via the AWS Console, but this guide uses the AWS CLI on a Linux deployment machine."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"331-create-ftc-iam-role",children:"3.3.1 Create FTC IAM Role"}),"\n",(0,i.jsx)(n.p,{children:"The Cambria FTC application requires a role with read/write permissions for S3 buckets."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createRoleForFtcInstances.sh eksctl-ftc-role ftcS3PermissionSample.json\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"eksctl-ftc-role"}),": IAM role name (must start with ",(0,i.jsx)(n.code,{children:"eksctl-"}),", be unique to the cluster, \u2264 64 characters)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ftcS3PermissionSample.json"}),": Capella-provided sample policy allowing S3 read/write/list access"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\ud83d\udcc4 Refer to AWS documentation to customize or generate your own S3 access policy:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://awspolicygen.s3.amazonaws.com/policygen.html",children:"AWS IAM Policy Generator"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"332-create-ftc-autoscaler-roles",children:"3.3.2 Create FTC Autoscaler Roles"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Only required if using Cambria FTC's autoscaler feature."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Run the following script:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createRolesForFtcAutoscaler.sh eksctl-autoscaler-role eksctl-autoscaler-cfg-role\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"eksctl-autoscaler-role"}),": IAM role for the autoscaler container"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"eksctl-autoscaler-cfg-role"}),": IAM role for autoscaler configuration"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\ud83d\udca1 Both role names must:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Start with ",(0,i.jsx)(n.code,{children:"eksctl-"})]}),"\n",(0,i.jsx)(n.li,{children:"Be unique to the EKS cluster"}),"\n",(0,i.jsx)(n.li,{children:"Be \u2264 64 characters in length"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./createRolesForFtcAutoscaler.sh eksctl-autoscaler-role eksctl-autoscaler-cfg-role\n"})}),"\n",(0,i.jsx)(n.h3,{id:"34-optional-restricting-cambria-ftc-encoder-designated-nodes-via-exclusion-label",children:"3.4 (Optional) Restricting Cambria FTC Encoder Designated Nodes via Exclusion Label"}),"\n",(0,i.jsx)(n.p,{children:"Follow these steps only if more precise control is required over which nodes Cambria FTC is installed on."}),"\n",(0,i.jsx)(n.h4,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["By default, the Cambria management and encoding applications are installed on separate nodes according to a specified node instance type.",(0,i.jsx)(n.br,{}),"\n","For example, if the management node instance type is set to ",(0,i.jsx)(n.code,{children:"c7i.xlarge"}),", Cambria Cluster can only be installed on nodes of that instance type, while Cambria FTC can be installed on nodes of other instance types."]}),"\n",(0,i.jsxs)(n.p,{children:["In some scenarios, the default setup may not be sufficient. For example, certain nodes may need to handle both management and encoding, or specific nodes in the cluster may be designated for other tasks and should not run encoding tasks.",(0,i.jsx)(n.br,{}),"\n","To accommodate these workflows, an exclusion label must be added to the nodes where Cambria FTC should be restricted."]}),"\n",(0,i.jsx)(n.h4,{id:"steps",children:"Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Find out which node(s) will be Cambria FTC restricted and note down the name:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Apply the following label to each of those nodes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl label node <node-name> no-capella-worker=true\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To apply the same restriction to all nodes in a node group:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'eksctl set labels \\\n  --cluster=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --labels="no-capella-worker=true" \\\n  --nodegroup=<node-group>\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In section 4.2 (Helm Configuration), set:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"workersCanUseManagerNodes: true\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"35-create-cambria-ftc-node-groups",children:"3.5 Create Cambria FTC Node Group(s)"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Skip this step if planning to use Cambria FTC's autoscaler."})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Run the following command to create a Node Group for the FTC worker application instances (replace highlighted values):"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Recommendation:"}),(0,i.jsx)(n.br,{}),"\n","Use ",(0,i.jsx)(n.code,{children:"c6a.4xlarge"})," instances based on [Section 1.3 Benchmarking]. Start with 1 node for testing."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl create nodegroup \\\n  --name=worker-nodes \\\n  --cluster=$CLUSTER_NAME \\\n  --region=$REGION \\\n  --node-private-networking \\\n  --nodes=1 \\\n  --instance-types=c6a.4xlarge \\\n  --node-ami-family=Ubuntu2204\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"36-gpu-operator-for-nvenc",children:"3.6 GPU Operator for NVENC"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Required only if using GPU instances.",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Not compatible with Cambria FTC's autoscaler."})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add nvidia https://helm.ngc.nvidia.com/nvidia; \\\nhelm repo update; \\\nhelm install nvidia-operator nvidia/gpu-operator \\\n  --create-namespace \\\n  --namespace gpu-operator\n"})}),"\n",(0,i.jsx)(n.p,{children:"Wait at least 5 minutes for installation to complete. Then run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n gpu-operator\n"})}),"\n",(0,i.jsx)(n.p,{children:"If pods are still initializing after 10 minutes:"}),"\n",(0,i.jsxs)(n.p,{children:["a. Confirm at least one AWS GPU instance is present",(0,i.jsx)(n.br,{}),"\n","b. Run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl describe pod <your-pod-name> -n gpu-operator\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Check the ",(0,i.jsx)(n.strong,{children:"Events"})," section and contact Capella Support if needed."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"37-performance-metrics-and-logging",children:"3.7 Performance Metrics and Logging"}),"\n",(0,i.jsx)(n.p,{children:"This section is required for logging and performance metrics."}),"\n",(0,i.jsxs)(n.p,{children:["Follow the guide below to install ",(0,i.jsx)(n.strong,{children:"Prometheus"}),", ",(0,i.jsx)(n.strong,{children:"Grafana"}),", ",(0,i.jsx)(n.strong,{children:"Loki"}),", and ",(0,i.jsx)(n.strong,{children:"Promtail"}),":"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/b9x59y4n3ff2i3g8if36s/Prometheus_Grafana_Setup_for_Cambria_Cluster_5_5_0_on_AWS_Kubernetes.pdf?rlkey=s1jz68o18s2ajyrak2334mdeh&st=wltynfq9&dl=1",children:"Prometheus & Grafana Setup for Cambria 5.5.0 on AWS (PDF)"})}),"\n",(0,i.jsx)(n.h2,{id:"4-install-cambria-cluster-ftc-and-dependencies",children:"4. Install Cambria Cluster, FTC, and Dependencies"}),"\n",(0,i.jsx)(n.h3,{id:"41-prerequisite-deploy-external-kubernetes-tools",children:"4.1 Prerequisite: Deploy External Kubernetes Tools"}),"\n",(0,i.jsx)(n.p,{children:"These tools must be deployed before Cambria FTC / Cluster can function properly."}),"\n",(0,i.jsx)(n.h4,{id:"411-required-tools",children:"4.1.1 Required Tools"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./deployCambriaKubeDependencies.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Verify resource statuses:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Pods should be ",(0,i.jsx)(n.code,{children:"Running"})]}),"\n",(0,i.jsxs)(n.li,{children:["All containers in ",(0,i.jsx)(n.code,{children:"READY"})," should be active"]}),"\n",(0,i.jsxs)(n.li,{children:["Services should have ",(0,i.jsx)(n.code,{children:"CLUSTER-IP"})," assigned"]}),"\n",(0,i.jsxs)(n.li,{children:["Check with:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get all -n cnpg-system\nkubectl get all -n argo-events\nkubectl get all -n cert-manager\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If resources aren't ready after 1 minute, contact Capella support."}),"\n",(0,i.jsx)(n.h4,{id:"412-optional-ingress-nginx",children:"4.1.2 (Optional) Ingress-Nginx"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Run these steps if ingress is needed, or for testing. See section 1.4 for access options."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Important:"})," Load balancer created ",(0,i.jsx)(n.strong,{children:"will not auto-delete"})," with the cluster and must be removed manually."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Deploy Ingress-Nginx:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.12.1/deploy/static/provider/aws/deploy.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Verify status:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get all -n ingress-nginx\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Pods should be ",(0,i.jsx)(n.code,{children:"Running"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ingress-nginx-controller"})," service should have an ",(0,i.jsx)(n.code,{children:"EXTERNAL-IP"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If resources remain unready, contact Capella support."}),"\n",(0,i.jsx)(n.h5,{id:"for-production-or-public-domaintls-access",children:"For Production or Public Domain/TLS Access"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Go to AWS Load Balancer and find the VPC ID of your cluster."}),"\n",(0,i.jsx)(n.li,{children:"In Security Groups, locate and open the matching VPC ID."}),"\n",(0,i.jsxs)(n.li,{children:["Add inbound rule:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Type: ",(0,i.jsx)(n.code,{children:"Custom ICMP - IPv4"})]}),"\n",(0,i.jsxs)(n.li,{children:["Protocol: ",(0,i.jsx)(n.code,{children:"Echo Request"})]}),"\n",(0,i.jsxs)(n.li,{children:["Source: ",(0,i.jsx)(n.code,{children:"0.0.0.0/0"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Add DNS entries for:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"api.mydomain.com\nwebui.mydomain.com\nmonitoring.mydomain.com\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"42-creating-and-editing-helm-configuration-file",children:"4.2 Creating and Editing Helm Configuration File"}),"\n",(0,i.jsx)(n.h4,{id:"steps-1",children:"Steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create default config:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm show values capella-cluster.tgz > cambriaClusterConfig.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Edit ",(0,i.jsx)(n.code,{children:"cambriaClusterConfig.yaml"})," with a text editor."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"key-settings",children:"Key Settings:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"workersCanUseManagerNodes: false"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Set to ",(0,i.jsx)(n.code,{children:"true"})," if using exclusion labels (see section 3.4)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"workersUseGPU: false"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Set to ",(0,i.jsx)(n.code,{children:"true"})," for NVENC GPU workflows."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"nbGPUs: 1"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Set to the number of GPUs per worker node."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:'managerInstanceType: "c7i.xlarge"'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Set to your selected manager node instance type."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"ftcEnableAutoScaler: true"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Set to ",(0,i.jsx)(n.code,{children:"false"})," to manually add FTC nodes instead of autoscaling."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"42-helm-configuration-yaml-reference",children:"4.2. Helm Configuration YAML Reference"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# ftcAutoScalerExtraConfig: extra config for autoscaler.\nftcAutoScalerExtraConfig:\n  cpClusterName: cambria-cluster\n  cpCloudVendor: AWS\n  cpRegion: us-west-2\n  cpNodeRole: arn:aws:iam::12341234:role/eksctl-autoscaler-config-role\n  cpCapacityType: dedicated\n\n# ftcInstanceType: instance type for the FTC nodes\nftcInstanceType: "c6a.4xlarge"\n\n# maxFTCInstances: maximum number of FTC instances\nmaxFTCInstances: 20\n\n# pgInstances: number of postgresql database instances\npgInstances: 3\n\n# cambriaClusterReplicas: number of Cambria Cluster instances\ncambriaClusterReplicas: 3\n\nexternalAccess:\n  exposeStreamServiceExternally: true\n  enableIngress: true\n  hostName: myhost.com\n  acmeRegistrationEmail: test@example.com\n  acmeServer: https://acme-staging-v02.api.letsencrypt.org/directory\n\nsecrets:\n  pgClusterPassword: "xrtVeQ4nN82SSiYHoswqdURZ\u2026"\n  ftcLicenseKey: "2XXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX-XXXXXX"\n  cambriaClusterAPIToken: "12345678-1234-43f8-b4fc-53afd3893d5f"\n  cambriaClusterWebUIUser: "admin,defaultWebUIUser,RZvSSd3ffsElsCEEe9"\n  argoEventWebhookSourceBearerToken: "L9Em5WIW8yth6H4uPtzT"\n\naws:\n  role:\n    ftc: arn:aws:iam::12341234:role/eksctl-ftc-role\n    autoscaler: arn:aws:iam::12341234:role/eksctl-autoscaler-role\n\noptionalInstall:\n  enableEventing: true\n  \n  ## 4.3. Installing Cambria FTC / Cluster\n\nWait at least 5 minutes after installing prerequisites before moving on to this step. In a command line / terminal window, run:\n\n```bash\nhelm upgrade --install capella-cluster capella-cluster.tgz --values cambriaClusterConfig.yaml\n'})}),"\n",(0,i.jsx)(n.p,{children:"Expected output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Release "capella-cluster" does not exist. Installing it now.\nNAME: capella-cluster\nLAST DEPLOYED: Thu May 3 10:09:47 2023\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\n'})}),"\n",(0,i.jsx)(n.p,{children:"Several components are now being deployed. Wait a few minutes."}),"\n",(0,i.jsxs)(n.p,{children:["The default VPC and security groups will be created. Refer to ",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/best-practices/network-security.html",children:"AWS Network Security Best Practices"})," and section 1.5 for required Capella ports."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-verify-cambria-ftc--cluster-installation",children:"5. Verify Cambria FTC / Cluster Installation"}),"\n",(0,i.jsx)(n.h3,{id:"51-verify-cambria-cluster-deployment",children:"5.1. Verify Cambria Cluster Deployment"}),"\n",(0,i.jsx)(n.p,{children:"Run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get all -n default\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check for the following:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Resource"}),(0,i.jsx)(n.th,{children:"Expected Content"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Deployments"}),(0,i.jsxs)(n.td,{children:["1 ",(0,i.jsx)(n.code,{children:"cambriaclusterapp"})," and 1 ",(0,i.jsx)(n.code,{children:"cambriaclusterwebui"})," deployment with all items active"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Pods"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"X"})," pods named ",(0,i.jsx)(n.code,{children:"cambriaclusterapp"}),", ",(0,i.jsx)(n.code,{children:"X"})," pods with ",(0,i.jsx)(n.code,{children:"pgcluster"}),", and 1 ",(0,i.jsx)(n.code,{children:"cambriaclusterwebui"})," pod\u2014all Running"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Services"}),(0,i.jsxs)(n.td,{children:["3 ",(0,i.jsx)(n.code,{children:"pgcluster"})," services with ",(0,i.jsx)(n.code,{children:"CLUSTER-IP"}),", 1 ",(0,i.jsx)(n.code,{children:"cambriaclusterservice"}),", and 1 ",(0,i.jsx)(n.code,{children:"cambriaclusterwebuiservice"})," with ",(0,i.jsx)(n.code,{children:"EXTERNAL-IP"})," if ",(0,i.jsx)(n.code,{children:"exposeStreamServiceExternally"})," is true"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"If resources aren't ready after a few minutes, contact Capella support."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"52-verify-cambria-ftc-deployment",children:"5.2. Verify Cambria FTC Deployment"}),"\n",(0,i.jsx)(n.p,{children:"Run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get all -n capella-worker\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check for the following:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Resource"}),(0,i.jsx)(n.th,{children:"Expected Content"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Pods"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"X"})," pods with ",(0,i.jsx)(n.code,{children:"cambriaftcapp"}),". If autoscaler is enabled, they will be pending. If not, ",(0,i.jsx)(n.code,{children:"Y"})," pods should be active"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Deployments"}),(0,i.jsxs)(n.td,{children:["1 ",(0,i.jsx)(n.code,{children:"cambriaftcapp"})," deployment"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Wait a few minutes if needed. If issues persist, contact Capella support."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"53-verify-applications-are-accessible",children:"5.3. Verify Applications are Accessible"}),"\n",(0,i.jsx)(n.h4,{id:"531-cambria-cluster-webui",children:"5.3.1. Cambria Cluster WebUI"}),"\n",(0,i.jsx)(n.p,{children:"Skip if WebUI is disabled in the Helm config or if ingress is used."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 1: External URL"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get svc/cambriaclusterwebuiservice -n default -o=jsonpath=\"{'https://'}{.status.loadBalancer.ingress[0].hostname}{':8161'}{'\n'}\"\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://192.122.45.33:8161\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Non-External Access (Port Forwarding)"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n default svc/cambriaclusterwebuiservice 8161:8161 --address=0.0.0.0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Access URL depends on your machine:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://<server>:8161\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"localhost"})," if browser and terminal are the same machine."]}),"\n",(0,i.jsx)(n.p,{children:'Open the URL in a browser. You may encounter an "Unsafe" warning page:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n![Screenshot](01_filter_icon.png)\n\n3. Click on Advanced and Proceed to [ EXTERNAL IP ] (unsafe). This will show the login page.\n\n![Screenshot](02_filter_icon.png)\n\n4. Log in using the credentials created in the helm values yaml file (See cambriaClusterWebUIUser)\n\n## 5.3.1. Cambria Cluster WebUI\n\n1. Get the WebUI address. A web browser is required to access the WebUI:\n\n**Option 1: External Url if External Access is Enabled**\n```bash\nkubectl get svc/cambriaclusterwebuiservice -n default -o=jsonpath=\"{'https://'}{.status.loadBalancer.ingress[0].hostname}{':8161'}{'\n'}\"\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://192.122.45.33:8161\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Non-External Url Access"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n default svc/cambriaclusterwebuiservice 8161:8161 --address=0.0.0.0\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Access using a web browser:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"https://<server>:8161"})," (replace ",(0,i.jsx)(n.code,{children:"<server>"})," with localhost or the server's IP)"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"Advanced"})," and ",(0,i.jsx)(n.strong,{children:"Proceed to [ EXTERNAL IP ] (unsafe)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Log in using the credentials from ",(0,i.jsx)(n.code,{children:"cambriaClusterWebUIUser"})," in the Helm config."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"532-cambria-cluster-rest-api",children:"5.3.2. Cambria Cluster REST API"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 1: External Url if External Access is Enabled"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get svc/cambriaclusterservice -n default -o=jsonpath=\"{'https://'}{.status.loadBalancer.ingress[0].hostname}{':8650'}{'\n'}\"\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Non-External Url Access"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n default svc/cambriaclusterservice 8650:8650 --address=0.0.0.0\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Check API:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -k -X GET https://<server>:8650/CambriaFC/v1/SystemInfo\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"533-cambria-ingress",children:"5.3.3. Cambria Ingress"}),"\n",(0,i.jsx)(n.h3,{id:"5331-get-the-ingress-endpoints",children:"5.3.3.1. Get the Ingress Endpoints"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 1: Default Testing Ingress"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get ingress -A\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolve ELB hostname"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ping a1c1d1a23a121.us-west-2.elb.amazonaws.com\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Edit ",(0,i.jsx)(n.code,{children:"/etc/hosts"}),":"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"55.99.103.99 api.myhost.com\n55.99.103.99 webui.myhost.com\n55.99.103.99 monitoring.myhost.com\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Publicly Registered Domain (Production)"})}),"\n",(0,i.jsx)(n.p,{children:"Example URLs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["REST API: ",(0,i.jsx)(n.code,{children:"https://api.myhost.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["WebUI: ",(0,i.jsx)(n.code,{children:"https://webui.myhost.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["Grafana: ",(0,i.jsx)(n.code,{children:"https://monitoring.myhost.com"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"5332-test-ingress-endpoints",children:"5.3.3.2. Test Ingress Endpoints"}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["WebUI: ",(0,i.jsx)(n.code,{children:"https://webui.myhost.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["REST API: ",(0,i.jsx)(n.code,{children:"https://api.myhost.com/CambriaFC/v1/SystemInfo"})]}),"\n",(0,i.jsxs)(n.li,{children:["Grafana: ",(0,i.jsx)(n.code,{children:"https://monitoring.myhost.com"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"534-cambria-license",children:"5.3.4. Cambria License"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 1: External Url if External Access is Enabled"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get svc/cambriaclusterwebuiservice -n default -o=jsonpath=\"{'https://'}{.status.loadBalancer.ingress[0].hostname}{':8481'}{'\n'}\"\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Option 2: Non-External Url Access"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n default svc/cambriaclusterwebuiservice 8481:8481 --address=0.0.0.0\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Access using a browser:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"https://<server>:8481"})]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:'In a web browser, enter the above url. This should trigger an "Unsafe" page similar to the one below:'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot",src:s(1570).A+"",width:"536",height:"404"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Click on Advanced and Proceed to [ EXTERNAL IP ] (unsafe). This will show the login page."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot",src:s(8441).A+"",width:"536",height:"404"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Log in using the credentials created in the Helm values yaml file (See cambriaClusterWebUIUser)"}),"\n",(0,i.jsx)(n.li,{children:"Verify that the License Status is valid for at least either the Primary or Backup. Preferably, both Primary and Backup should be valid. If there are issues with the license, wait a few minutes as sometimes it takes a few minutes to properly update. If still facing issues, contact the Capella support team."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"6-testing-cambria-ftc--cluster",children:"6. Testing Cambria FTC / Cluster"}),"\n",(0,i.jsxs)(n.p,{children:["The following guide provides information on how to get started testing the Cambria FTC / Cluster software:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/5vra6xff23vvng7aa4qyx/Cambria_Cluster_and_FTC_5_5_0_Kubernetes_User_Guide.pdf?rlkey=j3l9wjjo5ncbub9bh9bizrukr&st=ablrc3pz&dl=1",children:"https://www.dropbox.com/scl/fi/5vra6xff23vvng7aa4qyx/Cambria_Cluster_and_FTC_5_5_0_Kubernetes_User_Guide.pdf?rlkey=j3l9wjjo5ncbub9bh9bizrukr&st=ablrc3pz&dl=1"})]}),"\n",(0,i.jsx)(n.h2,{id:"7-updating--upgrading-cambria-cluster--ftc",children:"7. Updating / Upgrading Cambria Cluster / FTC"}),"\n",(0,i.jsx)(n.p,{children:"There are currently two ways to update / upgrade Cambria FTC / Cluster in the Kubernetes environment."}),"\n",(0,i.jsx)(n.h3,{id:"71-option-1-normal-upgrade-via-helm-upgrade",children:"7.1. Option 1: Normal Upgrade via Helm Upgrade"}),"\n",(0,i.jsx)(n.p,{children:"This upgrade method is best for when changing version numbers, secrets such as the license key, WebUI users, etc, and Cambria FTC / Cambria Cluster-specific settings such as max number of pods, replicas, etc."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Warning:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pgClusterPassword"})," cannot currently be updated via this method"]}),"\n",(0,i.jsx)(n.li,{children:"Changing PostgreSQL version also cannot be updated via this method"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Edit the Helm configuration YAML for your Kubernetes environment or create a new configuration file."}),"\n",(0,i.jsxs)(n.li,{children:["Run the following command:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm upgrade capella-cluster capella-cluster.tgz --values cambriaClusterConfig.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Restart the deployments:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl rollout restart deployment cambriaclusterapp cambriaclusterwebui -n default\nkubectl rollout restart deployment cambriaftcapp -n capella-worker\n"})}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Wait a few minutes for the Kubernetes pods to install properly."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"72-option-2-upgrade-via-cambria-cluster-reinstallation",children:"7.2. Option 2: Upgrade via Cambria Cluster Reinstallation"}),"\n",(0,i.jsxs)(n.p,{children:["This is the most reliable option and involves uninstalling all Cambria components and reinstalling with a new Helm chart and values YAML file. ",(0,i.jsx)(n.strong,{children:"Note"}),": This will delete the database and all jobs in the Cambria Cluster UI."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Follow section 4.2 to create/edit the new ",(0,i.jsx)(n.code,{children:"cambriaClusterConfig.yaml"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Run:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm uninstall capella-cluster --wait\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Then reinstall:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install capella-cluster capella-cluster.tgz --values cambriaClusterConfig.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"73-upgrade-verification",children:"7.3. Upgrade Verification"}),"\n",(0,i.jsxs)(n.p,{children:["Use the steps in ",(0,i.jsx)(n.strong,{children:"Section 5: Verify Cambria FTC / Cluster Installation"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"8-deleting-kubernetes-cluster",children:"8. Deleting Kubernetes Cluster"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Remove the Helm deployments:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm uninstall capella-cluster -n default --wait\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Delete any persistent volumes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pv -o name | awk -F'/' '{print $2}' | xargs -I{} kubectl patch pv {} -p='{\"spec\": {\"persistentVolumeReclaimPolicy\": \"Delete\"}}'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If ingress-nginx was deployed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl delete namespace ingress-nginx\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Follow delete steps in Section 3.7 if applicable."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set cluster name and region:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export CLUSTER_NAME=cambria-cluster\nexport REGION=us-west-2\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Delete FTC role policy:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws iam delete-role-policy --role-name=eksctl-ftc-role --policy-name=S3AccessPolicy\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If using autoscaler:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws iam delete-role-policy --role-name=eksctl-autoscaler-role --policy-name=FTCAutoscalerPolicy\n./deleteConfigRoleForFtcAutoscaler.sh eksctl-autoscaler-cfg-role\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Delete the cluster:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"eksctl delete cluster --name=$CLUSTER_NAME --region=$REGION --wait\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Confirm via AWS Console: check that the cluster is no longer listed under Elastic Kubernetes Service in the chosen region."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"a. Search for Elastic Kubernetes Service in the region that the Kubernetes Cluster is located. Make sure the\ndeleted cluster does not show up on the list"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot",src:s(9476).A+"",width:"901",height:"266"})}),"\n",(0,i.jsx)(n.p,{children:"b. Search for CloudFormation in the region that the Kubernetes Cluster is located. Make sure there are no stacks\nspecific to the Kubernetes Cluster on the list"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot",src:s(7931).A+"",width:"920",height:"256"})}),"\n",(0,i.jsx)(n.p,{children:"c. Important: Check in EC2 Volumes and Load Balancers to make sure no volumes or load balancers were\nleftover from the kubernetes cluster. Most will have the name of the EKS cluster in the resource name"}),"\n",(0,i.jsx)(n.h2,{id:"9-quick-reference-installation-testing-and-teardown",children:"9. Quick Reference: Installation, Testing, and Teardown"}),"\n",(0,i.jsx)(n.h3,{id:"91-installation-deploy-from-linux-to-aws-kubernetes",children:"9.1. Installation (Deploy from Linux to AWS Kubernetes)"}),"\n",(0,i.jsx)(n.p,{children:"Use a Linux deployment machine (preferably an EC2 instance). Certain steps require an IAM Administrator to run the commands as they create specific roles for the deployment process."}),"\n",(0,i.jsx)(n.h4,{id:"911-prerequisites",children:"9.1.1. Prerequisites"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sudo apt update; sudo apt upgrade; sudo apt install curl unzip; \\\ncurl -o CambriaClusterKubernetesAWS_5_5_0.zip -L "https://www.dropbox.com/scl/fi/4dg2024wbbq0lx1qbnk8e/CambriaClusterKubernetesAWS_5_5_0.zip?rlkey=j0q7xgxv2v60x4bcwfoesd8nv&st=31ajhgif&dl=1"; \\\nunzip CambriaClusterKubernetesAWS_5_5_0.zip; \\\nchmod +x *.sh; \\\n./installKubeTools.sh; \\\n./installKubeToolsAws.sh\n'})}),"\n",(0,i.jsx)(n.h4,{id:"912-iam-administrator-required-steps",children:"9.1.2. IAM Administrator Required Steps"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query "Account" --output text); \\\n./createEksctlCustomAwsPolicies.sh\n./createEksctlClusterUserRole.sh eksctl-user\n'})}),"\n",(0,i.jsx)(n.h4,{id:"913-installation",children:"9.1.3. Installation"}),"\n",(0,i.jsx)(n.p,{children:"Make sure that the Linux deployment machine assumes the role created in section 9.1.2."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Set the following environment variables:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export CLUSTER_NAME=cambria-cluster\nexport REGION=us-west-2\nexport KUBEVERSION=1.32\nexport CAMBRIA_CLUSTER_NODE_COUNT=3\nexport CAMBRIA_CLUSTER_INSTANCE_TYPE=c7i.xlarge\nexport EBS_CSI_CONTROLLER_ROLE_NAME=eksctl-ebs-csi-driver-role\nexport FTC_ROLE_NAME=eksctl-ftc-role\nexport FTC_ROLE_POLICY_JSON=ftcS3PermissionSample.json\nexport AUTOSCALER_ROLE_NAME=eksctl-autoscaler-role\nexport AUTOSCALER_CONFIG_ROLE_NAME=eksctl-autoscaler-cfg-role\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Configure the Helm values file:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm show values capella-cluster.tgz > cambriaClusterConfig.yaml\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Run the install script:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./quickInstallCambriaClusterAws.sh; export KUBECONFIG=$CLUSTER_NAME-kubeconfig.yaml\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Install the monitoring/logging tools (see section 3.7)."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Perform installation verification (see section 5)."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"92-upgrades-and-teardown",children:"9.2. Upgrades and Teardown"}),"\n",(0,i.jsx)(n.h4,{id:"921-cambria-ftccluster-andor-kubernetes-cluster-upgrades",children:"9.2.1. Cambria FTC/Cluster and/or Kubernetes Cluster Upgrades"}),"\n",(0,i.jsxs)(n.p,{children:["Edit the ",(0,i.jsx)(n.code,{children:"capellaClusterConfig.yaml"})," file and run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./quickUpgradeCambriaCluster.sh\n"})}),"\n",(0,i.jsx)(n.h4,{id:"922-cambria-ftc--cluster-uninstall",children:"9.2.2. Cambria FTC | Cluster Uninstall"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm uninstall capella-cluster --wait\n"})}),"\n",(0,i.jsx)(n.h4,{id:"923-kubernetes-cluster-teardown",children:"9.2.3. Kubernetes Cluster Teardown"}),"\n",(0,i.jsx)(n.p,{children:"See section 8 for full teardown instructions."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"10-quick-reference-helpful-commandsinfo-for-after-installation",children:"10. Quick Reference: Helpful Commands/Info for After Installation"}),"\n",(0,i.jsx)(n.h3,{id:"aws-kubernetes-kubeconfig-file",children:"AWS Kubernetes Kubeconfig File"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws eks update-kubeconfig --name=CapellaEKS --region=us-west-2\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cambria-cluster-webui",children:"Cambria Cluster WebUI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get service/cambriaclusterwebuiservice -n default -o=jsonpath=\"{'https://'}{.status.loadBalancer.ingress[0].hostname}{':8161'}\"\n"})}),"\n",(0,i.jsx)(n.p,{children:"Login credentials are defined in the Helm values YAML file (see section 3.3)."}),"\n",(0,i.jsx)(n.h3,{id:"cambria-cluster-rest-api",children:"Cambria Cluster REST API"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get service/cambriaclusterservice -n default -o=jsonpath=\"{'https://'}{.status.loadBalancer.ingress[0].hostname}{':8650'}\"\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example REST URL:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://<hostname>:8650/CambriaFC/v1/Jobs?usertoken=<token>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"leader-cambria-cluster-pod",children:"Leader Cambria Cluster Pod"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl get lease -o=jsonpath="{.items[0].spec.holderIdentity}"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"cambria-ftc-instance-external-ip",children:"Cambria FTC Instance External IP"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["In the WebUI, go to the ",(0,i.jsx)(n.strong,{children:"Machines"})," tab and get the pod name."]}),"\n",(0,i.jsx)(n.li,{children:"Run:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get node/$(kubectl get pod/<pod-name> -n capella-worker -o=jsonpath={.spec.nodeName}) -o=jsonpath=\"{.status.addresses[1].address}{'\\n'}\"\n"})}),"\n",(0,i.jsx)(n.h2,{id:"remote-access-to-kubernetes-pod",children:"Remote Access to Kubernetes Pod"}),"\n",(0,i.jsx)(n.p,{children:"The general command for remote accessing a pod is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it <pod-name> -n <namespace> -- /bin/bash\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example with Cambria FTC:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it cambriaftcapp-5c79586784-wbfvf -n capella-worker -- /bin/bash\n"})}),"\n",(0,i.jsx)(n.h2,{id:"extracting-cambria-logs",children:"Extracting Cambria Logs"}),"\n",(0,i.jsx)(n.p,{children:"In a machine that has kubectl and the kubeconfig file for your Kubernetes cluster, open a terminal window and\nmake sure to set the KUBECONFIG environment variable to the path of your kubeconfig file. Then run one or\nmore of the following commands depending on what types of logs you need (or that Capella needs). You will get\na folder full of logs. Compress these logs into one zip file and send it to Capella:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Cambria FTC\nkubectl cp <pod-name>:/opt/capella/Cambria/Logs ./CambriaFTCLogs -n capella-worker\n\n# Cambria Cluster\nkubectl cp <pod-name>:/opt/capella/CambriaCluster/Logs ./CambriaClusterLogs -n default\n\n# Cambria License Manager (FTC)\nkubectl cp <pod-name>:/opt/capella/CambriaLicenseManager/Logs ./CambriaFTCLicLogs -n capella-worker\n\n# Cambria License Manager (Cluster)\nkubectl cp <pod-name>:/opt/capella/CambriaLicenseManager/Logs ./CambriaClusterLicLogs -n default\n"})}),"\n",(0,i.jsx)(n.h2,{id:"copy-files-to-cambria-pods",children:"Copy Files to Cambria Pods"}),"\n",(0,i.jsx)(n.p,{children:"In some cases, you might need to copy files to a Cambria FTC / Cluster pod. For example, you have an MP4 file\nyou want to use as a source directly from the encoding machine\u2019s file system. In this case, to copy the file over\nto the Cambria FTC / Cluster pod, do the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Copy a file to Cambria FTC pod\nkubectl cp /mnt/n/MySource.mp4 cambriaftcapp-7c55887db9-t42v7:/var/media/MySource.mp4 -n capella-worker\n\n# Copy a file to Cambria Cluster pod\nkubectl cp C:\\MyKeys\\MyKeyFile.key cambriaclusterapp-695dcc848f-vjpc7:/var/keys/MyKeyFile.key -n default\n\n# Copy a directory to Cambria FTC pod\nkubectl cp /mnt/n/MyMediaFiles cambriaftcapp-7c55887db9-t42v7:/var/temp/mediafiles -n capella-worker\n"})}),"\n",(0,i.jsx)(n.h2,{id:"restarting-pods",children:"Restarting Pods"}),"\n",(0,i.jsx)(n.p,{children:"Kubectl does not currently have a way to restart pods. Instead, a pod will need to be \u201crestarted\u201d by deleting the pod\nwhich causes a new pod to be created / existing pod to take over the containers."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Delete Cambria FTC pod\nkubectl delete pod cambriaftcapp-7c55887db9-t42v7 -n capella-worker\n\n# Delete Cambria Cluster pod\nkubectl delete pod cambriaclusterapp-695dcc848f-vjpc7 -n default\n"})}),"\n",(0,i.jsx)(n.h2,{id:"find-the-arn-of-a-role",children:"Find the ARN of a Role"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'aws iam get-role --role-name=eksctl-autoscaler-role-$CLUSTER_NAME --query "Role.Arn" --output text\n'})}),"\n",(0,i.jsx)(n.h2,{id:"11-glossary",children:"11. Glossary"}),"\n",(0,i.jsx)(n.h3,{id:"111-kubernetes",children:"11.1 Kubernetes"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/glossary/?fundamental=true",children:"Kubernetes Glossary"})}),"\n",(0,i.jsx)(n.h3,{id:"112-third-party-tools",children:"11.2 Third-Party Tools"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Argo:"})," Orchestrates parallel jobs in Kubernetes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Argo-Events:"})," Triggers K8s functions based on external events."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cert-Manager:"})," Manages TLS certificate automation."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Helm:"})," Tool for managing K8s apps."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ingress-Nginx:"})," Reverse proxy/load balancer for ingress."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"113-capella-applications",children:"11.3 Capella Applications"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cambriaclusterapp:"})," Core Cambria Cluster container."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cambriaftautoscale:"})," Spawns new FTC nodes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cambriaftcapp:"})," Main FTC container."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cambriaftcconnect:"})," Auto-connects FTC instances to Cluster."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cambrialeaderelector:"})," Elects primary Cluster instance."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"pgcluster-capella:"})," PostgreSQL backend for Cambria Cluster."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting-ftc-autoscaler",children:"Troubleshooting FTC Autoscaler"}),"\n",(0,i.jsx)(n.h3,{id:"no-instances-are-being-deployed",children:"No Instances Are Being Deployed"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"In the Linux deployment machine, run this command to get the logs of the FTC autoscaler:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl logs -c cambriaftcautoscale -n default $(kubectl get lease -o=jsonpath="{.items[0].spec.holderIdentity}")\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Check for any errors. Here are a few that have been found in the past:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[AWS] NodePoolCreate exception: One or more errors occurred. (No cluster found for name: xyz.)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Edit the Helm values (",(0,i.jsx)(n.code,{children:"cambriaClusterConfig.yaml"}),") and verify that ",(0,i.jsx)(n.code,{children:"cpClusterName"})," in",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"ftcAutoScalerExtraConfig"})," is set to the correct kubernetes cluster name. If not, change the name in the",(0,i.jsx)(n.br,{}),"\n","Helm values file and run the steps in ",(0,i.jsx)(n.strong,{children:"7. Updating / Upgrading Cambria Cluster / FTC"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[AWS] NodePoolCreate exception: One or more errors occurred. (Cross-account pass role is not allowed.)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This error can happen for many reasons but usually it means the IAM roles were not set up correctly or",(0,i.jsx)(n.br,{}),"\n","they were not configured correctly in the Helm values file. First, check the Helm values file and make",(0,i.jsx)(n.br,{}),"\n","sure all IAM roles specified are correct (See ",(0,i.jsx)(n.strong,{children:"4.2. Creating and Editing Helm Configuration File"}),").",(0,i.jsx)(n.br,{}),"\n","Otherwise, destroy the kubernetes cluster and re-create it."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[AWS] NodePoolCreate exception: One or more errors occurred. (User:  \narn:aws:sts::12341234:assumed-role/eksctl-XYZ/i-12341234  \nis not authorized to perform: ABC on resource: arn:aws::xyzabc1234)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Similar to the previous error. Verify that the correct roles were set in the Helm values file. Otherwise,",(0,i.jsx)(n.br,{}),"\n","destroy the kubernetes cluster and re-create it."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1570:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/03_filter_icon-74e5813eade408ffadb6b3408975b2a9.png"},7931:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/06_filter_icon-0d3cba70b4c9317379310ae3244900b4.png"},8441:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/04_filter_icon-74e5813eade408ffadb6b3408975b2a9.png"},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>t});var r=s(6540);const i={},l=r.createContext(i);function a(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(l.Provider,{value:n},e.children)}},9476:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/05_filter_icon-154420a4fb0a00390f9b69114ba89b57.png"}}]);