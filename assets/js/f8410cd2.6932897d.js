"use strict";(self.webpackChunkcapella_documentation=self.webpackChunkcapella_documentation||[]).push([[8777],{6499:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Cambria_FTC/Installation Guides/Kubernetes/Akamai/Akamai-Terraform_Kubernetes/cambria-cluster-ftc-terraform","title":"Cambria Cluster / FTC 5.5.0 - Terraform on Akamai Kubernetes","description":"Akamai Cloud Kubernetes Help Documentation","source":"@site/docs/Cambria_FTC/01-Installation Guides/01-Kubernetes/02-Akamai/Akamai-Terraform_Kubernetes/index_Terraform.md","sourceDirName":"Cambria_FTC/01-Installation Guides/01-Kubernetes/02-Akamai/Akamai-Terraform_Kubernetes","slug":"/Cambria_FTC/Installation Guides/Kubernetes/Akamai/Akamai-Terraform_Kubernetes/cambria-cluster-ftc-terraform","permalink":"/docs/Cambria_FTC/Installation Guides/Kubernetes/Akamai/Akamai-Terraform_Kubernetes/cambria-cluster-ftc-terraform","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"cambria-cluster-ftc-terraform","title":"Cambria Cluster / FTC 5.5.0 - Terraform on Akamai Kubernetes"},"sidebar":"FTCSidebar","previous":{"title":"Cambria Cluster / FTC 5.5.0 - AWS Kubernetes","permalink":"/docs/Cambria_FTC/Installation Guides/Kubernetes/AWS/"},"next":{"title":"Cambria Cluster / FTC 5.5.0 - Akamai Kubernetes","permalink":"/docs/Cambria_FTC/Installation Guides/Kubernetes/Akamai/Akamai-Kubernetes/cambria-cluster-ftc-akamai"}}');var i=r(4848),l=r(8453);const t={id:"cambria-cluster-ftc-terraform",title:"Cambria Cluster / FTC 5.5.0 - Terraform on Akamai Kubernetes"},a="Cambria Cluster / FTC 5.5.0",o={},d=[{value:"Akamai Cloud Kubernetes Help Documentation",id:"akamai-cloud-kubernetes-help-documentation",level:2},{value:"Terraform Installation",id:"terraform-installation",level:3},{value:"Document History",id:"document-history",level:2},{value:"Limitations and Security Information",id:"limitations-and-security-information",level:3},{value:"\u26a0\ufe0f Important: Before You Begin",id:"\ufe0f-important-before-you-begin",level:2},{value:"\u26a0\ufe0f Critical Information: Read Before Proceeding with Installation",id:"\ufe0f-critical-information-read-before-proceeding-with-installation",level:2},{value:"1. Prerequisites",id:"1-prerequisites",level:2},{value:"1.1. X11 Forwarding for User Interface",id:"11-x11-forwarding-for-user-interface",level:3},{value:"1.1.1. Option 1: Microsoft Windows Tools",id:"111-option-1-microsoft-windows-tools",level:4},{value:"1.1.2. Option 2: Apple macOS Tools",id:"112-option-2-apple-macos-tools",level:4},{value:"2. Prepare Deployment Server",id:"2-prepare-deployment-server",level:2},{value:"3. Installation",id:"3-installation",level:2},{value:"Option 1: Windows",id:"option-1-windows",level:3},{value:"Option 2: Unix (Linux, macOS)",id:"option-2-unix-linux-macos",level:3},{value:"Environment Variable Explanation",id:"environment-variable-explanation",level:3},{value:"5. Terraform UI Editor Configuration",id:"5-terraform-ui-editor-configuration",level:2},{value:"4. Verification and Testing",id:"4-verification-and-testing",level:2},{value:"5. Upgrading",id:"5-upgrading",level:2},{value:"5.1. Option 1: Normal Upgrade via Terraform Apply",id:"51-option-1-normal-upgrade-via-terraform-apply",level:3},{value:"5.2. Option 2: Upgrade via Cambria Cluster Reinstallation",id:"52-option-2-upgrade-via-cambria-cluster-reinstallation",level:3},{value:"6. Cleanup",id:"6-cleanup",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cambria-cluster--ftc-550",children:"Cambria Cluster / FTC 5.5.0"})}),"\n",(0,i.jsx)(n.h2,{id:"akamai-cloud-kubernetes-help-documentation",children:"Akamai Cloud Kubernetes Help Documentation"}),"\n",(0,i.jsx)(n.h3,{id:"terraform-installation",children:"Terraform Installation"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"document-history",children:"Document History"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Date"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.4.0"}),(0,i.jsx)(n.td,{children:"10/03/2024"}),(0,i.jsx)(n.td,{children:"Updated for release 5.4.0.21627 (Linux)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.5.0"}),(0,i.jsx)(n.td,{children:"04/11/2025"}),(0,i.jsx)(n.td,{children:"Updated for release 5.5.0.23529 (Linux)"})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Download the online version of this document for the latest information and latest files. Always download the latest files."})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Do not move forward with the installation process if you do not agree with the End User License Agreement (EULA) for our products.",(0,i.jsx)(n.br,{}),"\n","You can download and read the EULA for Cambria FTC, Cambria Cluster, and Cambria License Manager from the links below:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/1wg7ee7a59kzi8h/EULA_Cambria_License_Manager.pdf?dl=0",children:"Cambria License Manager EULA"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/oemlax63aatjjiw/EULA_Cluster.pdf?dl=0",children:"Cambria Cluster EULA"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/ualv9usxsowh6m2/EULA_FTC.pdf?dl=0",children:"Cambria FTC EULA"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"limitations-and-security-information",children:"Limitations and Security Information"}),"\n",(0,i.jsx)(n.p,{children:"Cambria FTC, Cluster, and License Manager are installed on Linux Docker containers. Limitations and security checks done for this version are included in our general Linux documents below:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/0rvskhpqtla6dffhbfli5/Linux_Cambria_Cluster_and_FTC_5_5_0_Guide.pdf?rlkey=ngryjzox121ow5fgbc4y8n2yd",children:"Linux Cambria Cluster and FTC 5.5.0 Guide"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," These documents are for informational use only. The setup for Kubernetes starts in section 2. Create Kubernetes Cluster."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," This document references Kubernetes version 1.32 only."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-important-before-you-begin",children:"\u26a0\ufe0f Important: Before You Begin"}),"\n",(0,i.jsx)(n.p,{children:"PDF documents have a copy/paste issue. For best results, download this document and any referenced PDF documents in this guide and open them in a PDF viewer such as Adobe Acrobat."}),"\n",(0,i.jsx)(n.p,{children:"For commands that are in more than one line, copy each line one by one and check that the copied command matches the one in the document."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-critical-information-read-before-proceeding-with-installation",children:"\u26a0\ufe0f Critical Information: Read Before Proceeding with Installation"}),"\n",(0,i.jsx)(n.p,{children:"Before starting the installation, carefully review the following considerations. Skipping this section may result in errors, failed deployments, or misconfigurations."}),"\n",(0,i.jsxs)(n.p,{children:["Read only the ",(0,i.jsx)(n.strong,{children:"Critical Information: Read Before Proceeding with Installation"})," sections of the following documents:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/irkmp89qh17bo9w4459qw/Cambria_Cluster_and_FTC_5_5_0_on_Akamai_Kubernetes.pdf?rlkey=vmq8fcqdbv3dul5cqq9em4r91&st=5gecxrgs&dl=0",children:"Cambria Cluster Installation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/rxshb6038wd9yg81kxagd/Prometheus_Grafana_Setup_for_Cambria_Cluster_5_5_0_on_Akamai_Kubernetes.pdf?rlkey=5l561e8x251y46gywx57k5svm&st=prp5ca3q&dl=0",children:"Monitoring and Logging with Prometheus and Loki"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-prerequisites",children:"1. Prerequisites"}),"\n",(0,i.jsx)(n.h3,{id:"11-x11-forwarding-for-user-interface",children:"1.1. X11 Forwarding for User Interface"}),"\n",(0,i.jsxs)(n.p,{children:["For ",(0,i.jsx)(n.strong,{children:"Windows and Mac only"}),", there are some special tools that need to be installed in order to be able to use the user interface from Capella's terraform installer.",(0,i.jsx)(n.br,{}),"\n","If using Linux, the machine must have a graphical user interface."]}),"\n",(0,i.jsx)(n.h4,{id:"111-option-1-microsoft-windows-tools",children:"1.1.1. Option 1: Microsoft Windows Tools"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Download and install the X11 Forwarding Tool Xming:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://github.com/marchaesen/vcxsrv/releases/download/21.1.13/vcxsrv-64.21.1.13.0.installer.exe",children:"Download vcxsrv"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Also, download and install PuTTY or similar tool that allows X11 Forwarding SSH:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html",children:"Download PuTTY"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open XLaunch and do the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Window 1:"})," Choose ",(0,i.jsx)(n.em,{children:"Multiple windows"})," and set Display number to ",(0,i.jsx)(n.code,{children:"0"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Window 2:"})," Choose ",(0,i.jsx)(n.em,{children:"Start no client"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Window 3:"})," Enable all checkboxes: Clipboard, Primary Selection, Native OpenGL, and Disable access control"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Window 4:"})," Click on ",(0,i.jsx)(n.em,{children:"Save configuration"})," and save this somewhere to reuse in the future"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"112-option-2-apple-macos-tools",children:"1.1.2. Option 2: Apple macOS Tools"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Download and install the X11 Forwarding Tool XQuartz:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://github.com/XQuartz/XQuartz/releases/download/XQuartz-2.8.5/XQuartz-2.8.5.pkg",children:"Download XQuartz"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-prepare-deployment-server",children:"2. Prepare Deployment Server"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["On the Akamai Dashboard, create a new ",(0,i.jsx)(n.strong,{children:"Ubuntu Linode"})," used for the Terraform deployment.",(0,i.jsx)(n.br,{}),"\n","For best performance, choose an ",(0,i.jsx)(n.strong,{children:"8GB RAM or higher"})," machine as X11 Forwarding uses a lot of memory on the Linode instance."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SSH into the new Linode and install general tools:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt upgrade\nsudo apt install curl unzip libice6 libsm6 dbus libgtk-3-0\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Download the Terraform package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -o terraform_LKE_CambriaCluster_1_0.zip -L "https://www.dropbox.com/scl/fi/t8pgwr6otlg4lesgf3xbq/terraform_LKE_CambriaCluster_1_0.zip?rlkey=82rjt9l3at2gfcztt7sy0zsz1&st=pwzmzhpb&dl=1"\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Unzip the package and make the shell scripts executable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"unzip terraform_LKE_CambriaCluster_1_0.zip\nchmod +x *.sh\nchmod +x ./TerraformVariableEditor\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Install the tools needed for deployment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./setupTools.sh\n./installLogcli.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Verify the tools are installed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl version --client\nhelm version\nterraform -v\nlogcli --version\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Exit from the SSH session."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-installation",children:"3. Installation"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["SSH into the instance created in section 2. ",(0,i.jsx)(n.strong,{children:"Prepare Deployment Server"})," using one of the following methods (depending on the OS being used as the SSH client):"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"option-1-windows",children:"Option 1: Windows"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.strong,{children:"PuTTY"})," or similar tool. Enable ",(0,i.jsx)(n.strong,{children:"X11 Forwarding"})," in the configuration. On PuTTY, this can be found under:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Connection > SSH > X11 > X11 forwarding"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["SSH into the instance with the created user. Usually, the user is ",(0,i.jsx)(n.code,{children:"root"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"option-2-unix-linux-macos",children:"Option 2: Unix (Linux, macOS)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open a terminal window and SSH into the Linode instance using the ",(0,i.jsx)(n.code,{children:"-Y"})," option and one of the created users. This is usually ",(0,i.jsx)(n.code,{children:"root"}),".",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ssh -Y -i "mysshkey" root@123.123.123.123\n'})}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Run the following script to set secrets as environment variables. These are important details such as credentials,\nlicense keys, etc. Reference the following table:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"source ./setEnvVariablesCambriaCluster.sh\n"})}),"\n",(0,i.jsx)(n.h3,{id:"environment-variable-explanation",children:"Environment Variable Explanation"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Explanation"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Linode API Token"})}),(0,i.jsxs)(n.td,{children:["API token from Akamai Cloud's Dashboard. ",(0,i.jsx)(n.a,{href:"https://www.linode.com/docs/products/tools/api/guides/manage-api-tokens/",children:"See guide"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"PostgreSQL Password"})}),(0,i.jsx)(n.td,{children:"The password for the PostgreSQL database that Cambria Cluster uses. General password rules apply."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Cambria API Token"})}),(0,i.jsxs)(n.td,{children:["A token needed for making calls to the Cambria FTC web server. General token rules apply (e.g., ",(0,i.jsx)(n.code,{children:"1234-5678-90abcdefg"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Web UI Users"})}),(0,i.jsxs)(n.td,{children:["Login credentials for the Cambria WebUIs for the Kubernetes cluster. Format: ",(0,i.jsx)(n.code,{children:"role,username,password"}),".",(0,i.jsx)("br",{}),"Allowed roles:",(0,i.jsx)("br",{}),"1. ",(0,i.jsx)(n.strong,{children:"admin"})," \u2013 Full access and user management",(0,i.jsx)("br",{}),"2. ",(0,i.jsx)(n.strong,{children:"superuser"})," \u2013 Full access",(0,i.jsx)("br",{}),"3. ",(0,i.jsx)(n.strong,{children:"user"})," \u2013 View-only",(0,i.jsx)("br",{}),"Example: ",(0,i.jsx)(n.code,{children:"admin,admin,changethispassword1234,user,guest,password123"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Argo Events Webhook Token"})}),(0,i.jsxs)(n.td,{children:["Token for specific Argo Events calls. General token rules apply (e.g., ",(0,i.jsx)(n.code,{children:"1234-5678-90abcdefg"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Cambria FTC License Key"})}),(0,i.jsxs)(n.td,{children:["Provided by Capella. Starts with a '2' (e.g., ",(0,i.jsx)(n.code,{children:"2AB122-11123A-ABC890-DEF345-ABC321-543A21"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Grafana Password"})}),(0,i.jsx)(n.td,{children:"Password for the Grafana Dashboard."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Access Key"})}),(0,i.jsxs)(n.td,{children:["S3-compatible log storage access key (e.g., ",(0,i.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Secret Key"})}),(0,i.jsxs)(n.td,{children:["S3-compatible log storage secret key (e.g., ",(0,i.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"}),")."]})]})]})]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Run the terraform editor UI:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./TerraformVariableEditor\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"Open Terraform File"})," and choose the ",(0,i.jsx)(n.code,{children:"CambriaCluster_LKE.tf"})," file."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"5-terraform-ui-editor-configuration",children:"5. Terraform UI Editor Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Using the UI, edit the fields accordingly. Reference the following table for values that should be changed:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Blue"}),": values in blue do not need to change unless the specific feature is needed / not needed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Red"}),": values in red are proprietary values that need to be changed based on your specific environment"]}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Explanation"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lke_cluster_name = CambriaFTCCluster"})}),(0,i.jsx)(n.td,{children:"The name of the Kubernetes cluster"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lk_region = us-mia"})}),(0,i.jsx)(n.td,{children:"The region code where the Kubernetes cluster should be deployed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lke_manager_pool_node_count = 3"})}),(0,i.jsx)(n.td,{children:"The number of Cambria Cluster nodes to create"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"workers_can_use_manager_nodes = false"})}),(0,i.jsx)(n.td,{children:"Whether the Cambria Cluster nodes should also handle encoding tasks"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"workersUseGPU = false"})}),(0,i.jsxs)(n.td,{children:["Set to ",(0,i.jsx)(n.code,{children:"true"})," to enable NVENC capabilities"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"nbGPUs = 1"})}),(0,i.jsx)(n.td,{children:"Max number of GPUs to use from encoding machines"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"manager_instance_type = g6-dedicated-4"})}),(0,i.jsx)(n.td,{children:"Instance type of the Cambria Cluster nodes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ftc_enable_auto_scaler = true"})}),(0,i.jsx)(n.td,{children:"Enable Cambria FTC's autoscaler"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ftc_instance_type = g6-dedicated-8"})}),(0,i.jsx)(n.td,{children:"Instance type for autoscaled encoders"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"max_ftc_instances = 5"})}),(0,i.jsx)(n.td,{children:"Max number of encoder instances"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cambria_cluster_replicas = 3"})}),(0,i.jsx)(n.td,{children:"Max number of management and replica nodes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"expose_capella_service_externally = true"})}),(0,i.jsx)(n.td,{children:"Create load balancers to expose Capella"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enable_ingress = true"})}),(0,i.jsx)(n.td,{children:"Create ingress for Capella applications"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"host_name = myhost.com"})}),(0,i.jsx)(n.td,{children:"Public domain name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"acme_registration_email = test@example.com"})}),(0,i.jsx)(n.td,{children:"Email for Let's Encrypt registration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"acme_server = https://acme-staging-v02.api.letsencrypt.org/directory"})}),(0,i.jsx)(n.td,{children:"ACME server URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enable_eventing = true"})}),(0,i.jsx)(n.td,{children:"Enable Argo eventing features"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"expose_grafana = true"})}),(0,i.jsx)(n.td,{children:"Publicly expose Grafana dashboard"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"loki_storage_type = s3_embedcred"})}),(0,i.jsx)(n.td,{children:"Storage type for Loki logs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"loki_local_storage_size_gi = 100"})}),(0,i.jsx)(n.td,{children:"Size of local storage in Gi for Loki"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'loki_s3_bucket_name = ""'})}),(0,i.jsx)(n.td,{children:"S3 bucket name for Loki"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'loki_s3_region = ""'})}),(0,i.jsx)(n.td,{children:"S3 bucket region for Loki"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"loki_replicas = 2"})}),(0,i.jsx)(n.td,{children:"Number of Loki replicas"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"loki_max_unavailable = 3"})}),(0,i.jsx)(n.td,{children:"Max unavailable Loki pods during upgrades"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"loki_log_retention_period = 7"})}),(0,i.jsx)(n.td,{children:"Days to retain logs"})]})]})]}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsxs)(n.li,{children:["Once done click on ",(0,i.jsx)(n.strong,{children:"Save Changes"})," and close the UI."]}),"\n",(0,i.jsx)(n.li,{children:"Run the following commands to create a Terraform plan:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"terraform init && terraform plan -out lke-plan.tfplan\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"8",children:["\n",(0,i.jsx)(n.li,{children:"Apply the Terraform plan to create the Kubernetes cluster:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"terraform apply -auto-approve lke-plan.tfplan\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"9",children:["\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.code,{children:"KUBECONFIG"})," environment variable:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export KUBECONFIG=kubeconfig.yaml\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"10",children:["\n",(0,i.jsx)(n.li,{children:"Save the following files securely for future changes or redeployment:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".tfstate"})," file"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"lke-plan.tfplan"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"CambriaCluster_LKE.tf"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"4-verification-and-testing",children:"4. Verification and Testing"}),"\n",(0,i.jsxs)(n.p,{children:["Follow the steps in section 5. ",(0,i.jsx)(n.strong,{children:"Verify Cambria FTC / Cluster Installation"})," of the main Cambria Cluster Kubernetes Installation Guide for verification and section 6. ",(0,i.jsx)(n.strong,{children:"Testing Cambria FTC / Cluster"})," for testing with Cambria FTC jobs:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/irkmp89qh17bo9w4459qw/Cambria_Cluster_and_FTC_5_5_0_on_Akamai_Kubernetes.pdf?rlkey=vmq8fcqdbv3dul5cqq9em4r91&st=5gecxrgs&dl=1",children:"Cambria Cluster and FTC 5.5.0 on Akamai Kubernetes (PDF)"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-upgrading",children:"5. Upgrading"}),"\n",(0,i.jsx)(n.h3,{id:"51-option-1-normal-upgrade-via-terraform-apply",children:"5.1. Option 1: Normal Upgrade via Terraform Apply"}),"\n",(0,i.jsx)(n.p,{children:"This upgrade method is best for when changing version numbers, secrets such as the license key, WebUI users, etc., and Cambria FTC / Cluster-specific settings such as max number of pods, replicas, etc."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Warning \u2013 Known Issues:"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pgClusterPassword"})," cannot currently be updated via this method."]}),"\n",(0,i.jsx)(n.li,{children:"Changing the PostgreSQL version is not supported via this method."}),"\n",(0,i.jsx)(n.li,{children:"The region of the cluster cannot be changed."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Follow the steps in section 3: ",(0,i.jsx)(n.em,{children:"Installation"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Follow the verification steps in section 4: ",(0,i.jsx)(n.em,{children:"Verification and Testing"})," to ensure the updates were applied."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"52-option-2-upgrade-via-cambria-cluster-reinstallation",children:"5.2. Option 2: Upgrade via Cambria Cluster Reinstallation"}),"\n",(0,i.jsx)(n.p,{children:"This is the most reliable upgrade option. It uninstalls all Cambria FTC and Cluster components and reinstalls them using a new Helm chart and values file. This will delete the database and remove all jobs from the Cambria Cluster UI."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Follow section 4.2: ",(0,i.jsx)(n.em,{children:"Creating and Editing Helm Configuration File"})," to prepare your new ",(0,i.jsx)(n.code,{children:"capellaClusterConfig.yaml"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Uninstall the current deployment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm uninstall capella-cluster --wait\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Reinstall using the updated values file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install capella-cluster capella-cluster.tgz --values cambriaClusterConfig.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Wait a few minutes for the Kubernetes pods to install."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Verify the installation using section 4: ",(0,i.jsx)(n.em,{children:"Verification and Testing"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-cleanup",children:"6. Cleanup"}),"\n",(0,i.jsx)(n.p,{children:"To clean up the environment, ensure the following steps are followed in order. If using FTC's autoscaler, verify that no leftover Cambria FTC nodes remain running."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Remove Helm deployments:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm uninstall capella-cluster -n default --wait\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If persistent volumes remain, patch them for deletion:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pv -o name | awk -F'/' '{print $2}' | xargs -I{} kubectl patch pv {} -p='{\"spec\": {\"persistentVolumeReclaimPolicy\": \"Delete\"}}'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Delete all contents from the monitoring namespace (Prometheus, Grafana, Loki, etc):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl delete namespace monitoring\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"ingress-nginx"})," was deployed:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl delete namespace ingress-nginx\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Destroy the Kubernetes cluster:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"terraform destroy -auto-approve\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"NodeBalancers"})," section of the cloud dashboard, delete any leftover balancers created by the Kubernetes cluster."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"Volumes"})," section, delete any remaining volumes created by the Kubernetes cluster."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var s=r(6540);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);