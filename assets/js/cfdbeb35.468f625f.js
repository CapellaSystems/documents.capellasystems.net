"use strict";(self.webpackChunkcapella_documentation=self.webpackChunkcapella_documentation||[]).push([[3715],{1045:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Cambria FTC/Installation Guides/Kubernetes/AWS/index","title":"index","description":"Cambria Cluster / FTC 5.5.0","source":"@site/docs/Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS/index.md","sourceDirName":"Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS","slug":"/Cambria FTC/Installation Guides/Kubernetes/AWS/","permalink":"/docs/Cambria FTC/Installation Guides/Kubernetes/AWS/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Cambria FTC/01-Installation Guides/01-Kubernetes/01-AWS/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"FTCSidebar","next":{"title":"index","permalink":"/docs/Cambria FTC/Installation Guides/Kubernetes/Akamai/"}}');var i=s(4848),t=s(8453);const a={},l=void 0,o={},d=[];function c(e){const n={a:"a",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Cambria Cluster / FTC 5.5.0"}),"\n",(0,i.jsx)(n.p,{children:"Akamai Cloud Kubernetes Help Documentation"}),"\n",(0,i.jsx)(n.p,{children:"Terraform Installation"}),"\n",(0,i.jsx)(n.p,{children:"\fDocument History"}),"\n",(0,i.jsx)(n.p,{children:"Version"}),"\n",(0,i.jsx)(n.p,{children:"Date"}),"\n",(0,i.jsx)(n.p,{children:"Description"}),"\n",(0,i.jsx)(n.p,{children:"5.4.0"}),"\n",(0,i.jsx)(n.p,{children:"5.5.0"}),"\n",(0,i.jsx)(n.p,{children:"10/03/2024 Updated for release 5.4.0.21627 (Linux)"}),"\n",(0,i.jsx)(n.p,{children:"04/11/2025 Updated for release 5.5.0.23529 (Linux)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Download the online version of this document for the latest information and latest files. Always\ndownload the latest files"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Do not move forward with the installation process if you do not agree with the End User License\nAgreement (EULA) for our products. You can download and read the EULA for Cambria FTC, Cambria\nCluster, and Cambria License Manager from the links below:"}),"\n",(0,i.jsxs)(n.p,{children:["Cambria Cluster | Cambria FTC | Cambria License Manager\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/1wg7ee7a59kzi8h/EULA%5C_Cambria%5C_License%5C_Manager.pdf?dl=0",children:"https://www.dropbox.com/s/1wg7ee7a59kzi8h/EULA\\_Cambria\\_License\\_Manager.pdf?dl=0"}),"\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/oemlax63aatjjiw/EULA%5C_Cluster.pdf?dl=0",children:"https://www.dropbox.com/s/oemlax63aatjjiw/EULA\\_Cluster.pdf?dl=0"}),"\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/s/ualv9usxsowh6m2/EULA%5C_FTC.pdf?dl=0",children:"https://www.dropbox.com/s/ualv9usxsowh6m2/EULA\\_FTC.pdf?dl=0"})]}),"\n",(0,i.jsx)(n.p,{children:"Limitations and Security Information\nCambria FTC, Cluster, and License Manager are installed on Linux Docker containers. Limitations and security checks\ndone for this version are included in our general Linux Documents below."}),"\n",(0,i.jsx)(n.p,{children:"Note: these documents are for informational use only. The setup for Kubernetes starts in section 2. Create\nKubernetes Cluster."}),"\n",(0,i.jsxs)(n.p,{children:["Cambria FTC / Cluster:\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/0rvskhpqtla6dffhbfli5/Linux%5C_Cambria%5C_Cluster%5C_and%5C_FTC%5C_5%5C_5%5C_0%5C_Guide.pdf?rlkey=ngry",children:"https://www.dropbox.com/scl/fi/0rvskhpqtla6dffhbfli5/Linux\\_Cambria\\_Cluster\\_and\\_FTC\\_5\\_5\\_0\\_Guide.pdf?rlkey=ngry"}),"\njzox121ow5fgbc4y8n2yd"]}),"\n",(0,i.jsx)(n.p,{children:"Note: this document references Kubernetes version 1.32 only"}),"\n",(0,i.jsx)(n.p,{children:"!Important! Before You Begin"}),"\n",(0,i.jsx)(n.p,{children:"PDF documents have a copy/paste issue. For best results, download this document and any referenced PDF\ndocuments in this guide and open them in a PDF viewer such as Adobe Acrobat."}),"\n",(0,i.jsx)(n.p,{children:"For commands that are in more than one line, copy each line one by one and check that the copied command\nmatches the one in the document."}),"\n",(0,i.jsx)(n.p,{children:"\u26a0 Critical Information: Read Before Proceeding with Installation\nBefore starting the installation, carefully review the following considerations. Skipping this section may\nresult in errors, failed deployments, or misconfigurations."}),"\n",(0,i.jsx)(n.p,{children:"Read only the Critical Information: Read Before Proceeding with Installation sections of the following documents:"}),"\n",(0,i.jsxs)(n.p,{children:["Cambria Cluster Installation:\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/irkmp89qh17bo9w4459qw/Cambria%5C_Cluster%5C_and%5C_FTC%5C_5%5C_5%5C_0%5C_on%5C_Akamai%5C_Kubernete",children:"https://www.dropbox.com/scl/fi/irkmp89qh17bo9w4459qw/Cambria\\_Cluster\\_and\\_FTC\\_5\\_5\\_0\\_on\\_Akamai\\_Kubernete"}),"\ns.pdf?rlkey=vmq8fcqdbv3dul5cqq9em4r91&st=5gecxrgs&dl=0"]}),"\n",(0,i.jsxs)(n.p,{children:["Monitoring and Logging with Prometheus and Loki:\n",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/rxshb6038wd9yg81kxagd/Prometheus%5C_Grafana%5C_Setup%5C_for%5C_Cambria%5C_Cluster%5C_5%5C_5%5C_0%5C",children:"https://www.dropbox.com/scl/fi/rxshb6038wd9yg81kxagd/Prometheus\\_Grafana\\_Setup\\_for\\_Cambria\\_Cluster\\_5\\_5\\_0\\"}),"_\non_Akamai_Kubernetes.pdf?rlkey=5l561e8x251y46gywx57k5svm&st=prp5ca3q&dl=0"]}),"\n",(0,i.jsx)(n.p,{children:"\f1. Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"1.1. X11 Forwarding for User Interface\nFor Windows and Mac only, there are some special tools that need to be installed in order to be able to use the user\ninterface from Capella's terraform installer. If using Linux, the machine must have a graphical user interface."}),"\n",(0,i.jsx)(n.p,{children:"1.1.1. Option 1: Microsoft Windows Tools"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Download and install the X11 Forwarding Tool Xming:\n",(0,i.jsx)(n.a,{href:"https://github.com/marchaesen/vcxsrv/releases/download/21.1.13/vcxsrv-64.21.1.13.0.installer.exe",children:"https://github.com/marchaesen/vcxsrv/releases/download/21.1.13/vcxsrv-64.21.1.13.0.installer.exe"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Also, download and install PuTTY or similar tool that allows X11 Forwarding SSH:\n",(0,i.jsx)(n.a,{href:"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html",children:"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open XLaunch and do the following:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"a. Window 1: Choose Multiple windows and set Display number to 0\nb. Window 2: Choose to Start no client\nc. Window 3: Enable all checkboxes: Clipboard, Primary Selection, Native opengl, and Disable access"}),"\n",(0,i.jsx)(n.p,{children:"control"}),"\n",(0,i.jsx)(n.p,{children:"d. Window 4: Click on Save configuration and save this somewhere to reuse in the future"}),"\n",(0,i.jsx)(n.p,{children:"1.1.2. Option 2: Apple MacOS Tools"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Download and install the X11 Forwarding Tool XQuartz:\n",(0,i.jsx)(n.a,{href:"https://github.com/XQuartz/XQuartz/releases/download/XQuartz-2.8.5/XQuartz-2.8.5.pkg",children:"https://github.com/XQuartz/XQuartz/releases/download/XQuartz-2.8.5/XQuartz-2.8.5.pkg"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Prepare Deployment Server"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"On the Akamai Dashboard, create a new Ubuntu Linode used for the terraform deployment. For best performance,\nchoose an 8GB RAM or higher machine as X11 Forwarding uses a lot of memory on the Linode instance"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SSH into the new Linode and install general tools:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"sudo apt update; sudo apt upgrade; sudo apt install curl unzip libice6 libsm6 dbus libgtk-3-0"}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Download the terraform package:"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:['curl -o terraform_LKE_CambriaCluster_1_0.zip -L\n"',(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/t8pgwr6otlg4lesgf3xbq/terraform%5C_LKE%5C_CambriaCluster%5C_1%5C_0.zip?rlkey=82rjt9l3at2",children:"https://www.dropbox.com/scl/fi/t8pgwr6otlg4lesgf3xbq/terraform\\_LKE\\_CambriaCluster\\_1\\_0.zip?rlkey=82rjt9l3at2"}),'\ngfcztt7sy0zsz1&st=pwzmzhpb&dl=1"']}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Unzip the package and make the shell scripts executable:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"unzip terraform_LKE_CambriaCluster_1_0.zip; chmod +x *.sh; chmod +x ./TerraformVariableEditor"}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Install the tools needed for deployment:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"./setupTools.sh; ./installLogcli.sh"}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Verify the tools are installed:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"kubectl version --client; helm version; terraform -v; logcli --version"}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsx)(n.li,{children:"Exit from the SSH session"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\f3. Installation"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"SSH into the instance created in section 2. Prepare Deployment Server using one of the following methods\n(depending on the OS being used as the SSH client):"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Option 1: Windows"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open PuTTY or similar tool. Enable X11 Forwarding in the configuration. On PuTTY, this can be found in\nConnection > SSH > X11 > X11 forwarding"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SSH into the instance with the created user. Usually, the user is root"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Option 2: Unix (Linux, MacOS)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Open a terminal window and ssh into the Linode instance using -Y option and one of the created users. This\nis usually root."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.p,{children:'ssh -Y -i "mysshkey" root@123.123.123.123'}),"\n",(0,i.jsx)(n.p,{children:"\f2. Run the following script to set secrets as environment variables. These are important details such as credentials,\nlicense keys, etc. Reference the following table:"}),"\n",(0,i.jsx)(n.p,{children:"source ./setEnvVariablesCambriaCluster.sh"}),"\n",(0,i.jsx)(n.p,{children:"Environment Variable"}),"\n",(0,i.jsx)(n.p,{children:"Explanation"}),"\n",(0,i.jsx)(n.p,{children:"Linode API Token"}),"\n",(0,i.jsxs)(n.p,{children:["API token from Akamai Cloud's Dashboard. See\n",(0,i.jsx)(n.a,{href:"https://www.linode.com/docs/products/tools/api/guides/manage-api-tokens/",children:"https://www.linode.com/docs/products/tools/api/guides/manage-api-tokens/"})]}),"\n",(0,i.jsx)(n.p,{children:"PostgreSQL Password"}),"\n",(0,i.jsx)(n.p,{children:"The password for the PostgreSQL database that Cambria Cluster uses. General\npassword rules apply"}),"\n",(0,i.jsx)(n.p,{children:"Cambria API Token"}),"\n",(0,i.jsx)(n.p,{children:"Web UI Users"}),"\n",(0,i.jsx)(n.p,{children:"A token needed for making calls to the Cambria FTC web server. General token\nrules apply (Eg. 1234-5678-90abcdefg)"}),"\n",(0,i.jsx)(n.p,{children:"This is the login credentials for all of the Cambria WebUIs for the kubernetes\ncluster. Each user is listed in the form:"}),"\n",(0,i.jsx)(n.p,{children:"role,username,password"}),"\n",(0,i.jsx)(n.p,{children:"Allowed roles:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"admin - can view/create/edit/delete anything on the WebUI. Can also\ncreate/manage WebUI users."}),"\n",(0,i.jsx)(n.li,{children:"superuser - can view/create/edit/delete anything on the WebUI."}),"\n",(0,i.jsx)(n.li,{children:"user - can only view anything on the WebUI."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For multiple users, separate each by a comma. Example:"}),"\n",(0,i.jsx)(n.p,{children:"admin,admin,changethispassword1234,user,guest,password123"}),"\n",(0,i.jsx)(n.p,{children:"Argo Events Webhook Token"}),"\n",(0,i.jsx)(n.p,{children:"A token needed for making specific argo events calls. General token rules apply\n(Eg. 1234-5678-90abcdefg)"}),"\n",(0,i.jsx)(n.p,{children:"Cambria FTC License Key"}),"\n",(0,i.jsx)(n.p,{children:"This is the Cambria FTC license key that Capella should have provided. The\nlicense key should start with a '2' in this case. Only one license key is needed\nhere (Eg. 2AB122-11123A-ABC890-DEF345-ABC321-543A21)"}),"\n",(0,i.jsx)(n.p,{children:"Grafana Password"}),"\n",(0,i.jsx)(n.p,{children:"The password for Grafana Dashboard. General password rules apply"}),"\n",(0,i.jsx)(n.p,{children:"Access Key"}),"\n",(0,i.jsx)(n.p,{children:"Secret Key"}),"\n",(0,i.jsx)(n.p,{children:"The recommended log storage solution is AWS S3 or compatible S3 storage. If\nusing this solution, this is the ACCESS_KEY or AWS_ACCESS_KEY_ID"}),"\n",(0,i.jsx)(n.p,{children:"The recommended log storage solution is AWS S3 or compatible S3 storage. If\nusing this solution, this is the SECRET_KEY or AWS_SECRET_ACCESS_KEY"}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Run the terraform editor UI:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"./TerraformVariableEditor"}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Click on Open Terraform File and choose the CambriaCluster_LKE.tf file."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\f5. Using the UI, edit the fields accordingly. Reference the following table for values that should be changed:"}),"\n",(0,i.jsx)(n.p,{children:"Blue: values in blue do not need to change unless the specific feature is needed / not needed\nRed: values in red are proprietary values that need to be changed based on your specific environment"}),"\n",(0,i.jsx)(n.p,{children:"Terraform UI Editor"}),"\n",(0,i.jsx)(n.p,{children:"Explanation"}),"\n",(0,i.jsx)(n.p,{children:"lke_cluster_name = CambriaFTCCluster"}),"\n",(0,i.jsx)(n.p,{children:"The name of the kubernetes cluster"}),"\n",(0,i.jsx)(n.p,{children:"lk_region = us-mia"}),"\n",(0,i.jsx)(n.p,{children:"The region code where the kubernetes cluster should be\ndeployed"}),"\n",(0,i.jsx)(n.p,{children:"lke_manager_pool_node_count = 3"}),"\n",(0,i.jsx)(n.p,{children:"The number of Cambria Cluster nodes to create"}),"\n",(0,i.jsx)(n.p,{children:"workers_can_use_manager_nodes = false"}),"\n",(0,i.jsx)(n.p,{children:"Whether the Cambria Cluster nodes should also be able\nto handle encoding tasks"}),"\n",(0,i.jsx)(n.p,{children:"workersUseGPU = false"}),"\n",(0,i.jsx)(n.p,{children:"nbGPUs = 1"}),"\n",(0,i.jsx)(n.p,{children:"manager_instance_type = g6-dedicated-4"}),"\n",(0,i.jsx)(n.p,{children:"ftc_enable_auto_scaler = true"}),"\n",(0,i.jsx)(n.p,{children:"ftc_instance_type = g6-dedicated-8"}),"\n",(0,i.jsx)(n.p,{children:"max_ftc_instances = 5"}),"\n",(0,i.jsx)(n.p,{children:"cambria_cluster_replicas = 3"}),"\n",(0,i.jsx)(n.p,{children:"expose_capella_service_externally = true"}),"\n",(0,i.jsx)(n.p,{children:"enable_ingress = true"}),"\n",(0,i.jsx)(n.p,{children:"host_name = myhost.com"}),"\n",(0,i.jsxs)(n.p,{children:["acme_registration_email = ",(0,i.jsx)(n.a,{href:"mailto:test@example.com",children:"test@example.com"})]}),"\n",(0,i.jsxs)(n.p,{children:["acme_server = ",(0,i.jsx)(n.a,{href:"https://acme-staging-v02.api.letsencrypt.org/directory",children:"https://acme-staging-v02.api.letsencrypt.org/directory"})]}),"\n",(0,i.jsx)(n.p,{children:"enable_eventing = true"}),"\n",(0,i.jsx)(n.p,{children:"expose_grafana = true"}),"\n",(0,i.jsx)(n.p,{children:"This must be set to true if planning to use NVENC\ncapabilities on the encoding machines"}),"\n",(0,i.jsx)(n.p,{children:"The max number of GPUs to use from the encoding\nmachines if GPU functionality is enabled. This value\nshould not exceed the amount of GPUs available"}),"\n",(0,i.jsx)(n.p,{children:"The instance type of the Cambria Cluster nodes. See\nAkamai documentation for information on how to get\nthe instance type name"}),"\n",(0,i.jsx)(n.p,{children:"This option enables the use of Cambria FTC's autoscaler\nfeature. Set to false to disable it. If this is disabled, the\nencoder nodes will have to be manually created through\nthe Akamai dashboard (or API)."}),"\n",(0,i.jsx)(n.p,{children:"If using Cambria FTC's autoscaler feature, change this\nto the instance type that the autoscaled encoders\nshould be"}),"\n",(0,i.jsx)(n.p,{children:"The maximum number of encoders that the kubernetes\ncluster can have up and running"}),"\n",(0,i.jsx)(n.p,{children:"The maximum number of Cambria Cluster management"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"replica machines to have up and running. This should\nmatch the lke_manager_pool_node_count or be\ngreater if more manager replicas will be needed after\ninstallation"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This option tells the deployment to create load\nbalancers to publicly expose the Capella application"}),"\n",(0,i.jsx)(n.p,{children:"This option tells the deployment to create an ingress for\nthe Capella applications that should be exposed."}),"\n",(0,i.jsx)(n.p,{children:"If enable_ingress is true, this is information needed to\nuse a publicly registered domain name and TLS\ncertificate for the Capella applications"}),"\n",(0,i.jsx)(n.p,{children:"This option is for argo events where different\nevent-based functionality can be used"}),"\n",(0,i.jsx)(n.p,{children:"This option tells the deployment to make the Grafana\ndashboard accessible publicly via a load balancer"}),"\n",(0,i.jsx)(n.p,{children:"\floki_storage_type = s3_embedcred"}),"\n",(0,i.jsx)(n.p,{children:"loki_local_storage_size_gi = 100"}),"\n",(0,i.jsx)(n.p,{children:'loki_s3_bucket_name = ""'}),"\n",(0,i.jsx)(n.p,{children:'loki_s3_region = ""'}),"\n",(0,i.jsx)(n.p,{children:"loki_replicas = 2"}),"\n",(0,i.jsx)(n.p,{children:"loki_max_unavailable = 3"}),"\n",(0,i.jsx)(n.p,{children:"loki_log_retention_period = 7"}),"\n",(0,i.jsx)(n.p,{children:"This is for deciding what type of storage to use for Loki\nlogs. It is recommended to use an S3 compatible\nstorage like AWS S3. For testing purposes only, there is\na filesystem version of the Loki log storage deployment.\nFor this, change this to local"}),"\n",(0,i.jsx)(n.p,{children:"This option is only used for the local loki_storage_type.\nThis is how many GB the Loki log volume should be.\nVolumes can fill up quickly so testing different volume\nsizes may be required."}),"\n",(0,i.jsx)(n.p,{children:"This option should be changed if using the\ns3_embedcred loki_storage_type. This is the name of\nthe S3 compatible bucket to write logs to"}),"\n",(0,i.jsx)(n.p,{children:"This option should be changed if using the\ns3_embedcred loki_storage_type. This is the region\nwhere the S3 bucket is located"}),"\n",(0,i.jsx)(n.p,{children:"This option should be changed if using the\ns3_embedcred loki_storage_type. This is the number\nof Loki pod replicas to use for handling log requests. At\nleast 2 replicas need to be active for Loki to work\nproperly. Also, there should be at least the same\namount of nodes running to cover the number of\nreplicas specified here."}),"\n",(0,i.jsx)(n.p,{children:"This option should be changed if using the\ns3_embedcred loki_storage_type. This is how many\nLoki pods can be taken down when performing\nupgrades. For simplicity, this value should be\nloki_replicas + 1"}),"\n",(0,i.jsx)(n.p,{children:"This is the number of days to retain Loki logs in the\nstorage device. By default, this is set to 7 days."}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Once done, click on Save Changes and close the UI"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run the following commands to create a terraform plan. Follow the prompts on the terminal window:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"terraform init && terraform plan -out lke-plan.tfplan"}),"\n",(0,i.jsxs)(n.ol,{start:"8",children:["\n",(0,i.jsx)(n.li,{children:"Run the following command to create the kubernetes cluster:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"terraform apply -auto-approve lke-plan.tfplan"}),"\n",(0,i.jsxs)(n.ol,{start:"9",children:["\n",(0,i.jsx)(n.li,{children:"Set the KUBECONFIG environment variable:"}),"\n"]}),"\n",(0,i.jsx)("pre",{children:" ```bash export KUBECONFIG=kubeconfig.yaml ``` "}),"\n",(0,i.jsxs)(n.ol,{start:"10",children:["\n",(0,i.jsx)(n.li,{children:"If everything goes well, save the terraform state file (.tfstate) that is created, the terraform plan\n(lke-plan.tfplan), and also the CambriaCluster_LKE.tf somewhere safe. This is needed for future deployments\nand to make changes to the created kubernetes cluster"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\f4. Verification and Testing"}),"\n",(0,i.jsx)(n.p,{children:"Follow the steps in section 5. Verify Cambria FTC / Cluster Installation of the main Cambria Cluster Kubernetes\nInstallation Guide for verification and section 6. Testing Cambria FTC / Cluster for testing with Cambria FTC jobs:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.dropbox.com/scl/fi/irkmp89qh17bo9w4459qw/Cambria%5C_Cluster%5C_and%5C_FTC%5C_5%5C_5%5C_0%5C_on%5C_Akamai%5C_Kubernete",children:"https://www.dropbox.com/scl/fi/irkmp89qh17bo9w4459qw/Cambria\\_Cluster\\_and\\_FTC\\_5\\_5\\_0\\_on\\_Akamai\\_Kubernete"}),"\ns.pdf?rlkey=vmq8fcqdbv3dul5cqq9em4r91&st=5gecxrgs&dl=1"]}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Upgrading"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"5.1. Option 1: Normal Upgrade via Terraform Apply\nThis upgrade method is best for when changing version numbers, secrets such as the license key, WebUI users,\netc, and Cambria FTC | Cambria Cluster specific settings such as max number of pods, replicas, etc."}),"\n",(0,i.jsx)(n.p,{children:"!Warning! Known Issues"}),"\n",(0,i.jsx)(n.p,{children:"\u25cf pgClusterPassword cannot currently be updated via this method\n\u25cf Changing postgres version also cannot be updated via this method\n\u25cf Cannot change the region of the cluster"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Follow the steps in section 3. Installation"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Follow the verification steps in section 4. Verification and Testing to verify updates were applied"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"5.2. Option 2: Upgrade via Cambria Cluster Reinstallation\nFor any upgrade cases for the Cambria Cluster | Cambria FTC environment, this is the most reliable option. This\nupgrade option basically uninstalls all of the Cambria FTC and Cluster components and then reinstall with the\nnew Helm chart and values (.yaml) file. As a result, this will delete the database and delete all of your\njobs in the Cambria Cluster UI."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Follow section 4.2. Creating and Editing Helm Configuration File to download and edit your new\ncapellaClusterConfig.yaml file."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In a command line / terminal window in your local server, run the following command:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"helm uninstall capella-cluster --wait"}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Deploy the Helm configuration file with the following command"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"helm upgrade --install capella-cluster capella-cluster.tgz --values cambriaClusterConfig.yaml"}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Wait a few minutes for the kubernetes pods to install properly"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Follow the verification steps in section 4. Verification and Testing to verify updates were applied"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\f6. Cleanup\nMany resources are created in a Kubernetes environment. It is important that each step is followed\ncarefully: If using FTC's autoscaler, make sure no leftover Cambria FTC nodes are running."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Run the following commands to remove the Helm deployments:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"helm uninstall capella-cluster -n default --wait"}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"If any volumes are remaining, run the following command:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pv -o name | awk -F'/' '{print $2}' | xargs -I{} kubectl patch pv {} -p='{\"spec\": {\"persistentVolumeReclaimPolicy\": \"Delete\"}}'\n"})}),"\n",(0,i.jsxs)("pre",{children:[" ",(0,i.jsx)(n.code,{children:'{"persistentVolumeReclaimPolicy": "Delete"}'})," "]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Delete all of the contents from the monitoring namespace (Prometheus, Grafana, Loki, etc):"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"kubectl delete namespace monitoring"}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Only if the ingress-nginx tool was deployed, do the following:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"kubectl delete namespace ingress-nginx"}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Run the following command to destroy the kubernetes cluster:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"terraform destroy -auto-approve"}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In the NodeBalancers section, delete any leftover node balancers that were created by the Kubernetes\ncluster"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In the Volumes section, delete any leftover volumes that were created by the Kubernetes Cluster"}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);